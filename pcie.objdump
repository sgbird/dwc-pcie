
pcie:     file format elf64-littleriscv


Disassembly of section .text:

000000ff60400000 <__raw_writel>:
static inline void __raw_writew(uint16_t v, uint32_t a)
{
        asm volatile("sh %0, 0(%1)" : : "r" (v), "r" (a));
}
static inline void __raw_writel(uint32_t v, uint64_t a)
{
  ff60400000:	1101                	addi	sp,sp,-32
  ff60400002:	ec22                	sd	s0,24(sp)
  ff60400004:	1000                	addi	s0,sp,32
  ff60400006:	87aa                	mv	a5,a0
  ff60400008:	feb43023          	sd	a1,-32(s0)
  ff6040000c:	fef42623          	sw	a5,-20(s0)
        asm volatile("sw %0, 0(%1)" : : "r" (v), "r" (a));
  ff60400010:	fec42783          	lw	a5,-20(s0)
  ff60400014:	fe043703          	ld	a4,-32(s0)
  ff60400018:	c31c                	sw	a5,0(a4)
}
  ff6040001a:	0001                	nop
  ff6040001c:	6462                	ld	s0,24(sp)
  ff6040001e:	6105                	addi	sp,sp,32
  ff60400020:	8082                	ret

000000ff60400022 <__raw_readl>:

        asm volatile("lh %0, 0(%1)" : "=r" (v) : "r" (a));
            return v;
}
static inline uint32_t __raw_readl(const uint64_t a)
{
  ff60400022:	7179                	addi	sp,sp,-48
  ff60400024:	f422                	sd	s0,40(sp)
  ff60400026:	1800                	addi	s0,sp,48
  ff60400028:	fca43c23          	sd	a0,-40(s0)
        uint32_t v;

        asm volatile("lw %0, 0(%1)" : "=r" (v) : "r" (a));
  ff6040002c:	fd843783          	ld	a5,-40(s0)
  ff60400030:	439c                	lw	a5,0(a5)
  ff60400032:	fef42623          	sw	a5,-20(s0)
            return v;
  ff60400036:	fec42783          	lw	a5,-20(s0)
}
  ff6040003a:	853e                	mv	a0,a5
  ff6040003c:	7422                	ld	s0,40(sp)
  ff6040003e:	6145                	addi	sp,sp,48
  ff60400040:	8082                	ret

000000ff60400042 <printf>:
#include "pci_glue.h"

#ifdef STANDALONE
int printf(const char *format, ...){};
  ff60400042:	711d                	addi	sp,sp,-96
  ff60400044:	ec22                	sd	s0,24(sp)
  ff60400046:	1000                	addi	s0,sp,32
  ff60400048:	fea43423          	sd	a0,-24(s0)
  ff6040004c:	e40c                	sd	a1,8(s0)
  ff6040004e:	e810                	sd	a2,16(s0)
  ff60400050:	ec14                	sd	a3,24(s0)
  ff60400052:	f018                	sd	a4,32(s0)
  ff60400054:	f41c                	sd	a5,40(s0)
  ff60400056:	03043823          	sd	a6,48(s0)
  ff6040005a:	03143c23          	sd	a7,56(s0)
  ff6040005e:	0001                	nop
  ff60400060:	853e                	mv	a0,a5
  ff60400062:	6462                	ld	s0,24(sp)
  ff60400064:	6125                	addi	sp,sp,96
  ff60400066:	8082                	ret

000000ff60400068 <udelay>:
void udelay(uint32_t time){};
  ff60400068:	1101                	addi	sp,sp,-32
  ff6040006a:	ec22                	sd	s0,24(sp)
  ff6040006c:	1000                	addi	s0,sp,32
  ff6040006e:	87aa                	mv	a5,a0
  ff60400070:	fef42623          	sw	a5,-20(s0)
  ff60400074:	0001                	nop
  ff60400076:	6462                	ld	s0,24(sp)
  ff60400078:	6105                	addi	sp,sp,32
  ff6040007a:	8082                	ret

000000ff6040007c <memset>:
void* memset(void* dst,int val, size_t count)
{
  ff6040007c:	7139                	addi	sp,sp,-64
  ff6040007e:	fc22                	sd	s0,56(sp)
  ff60400080:	0080                	addi	s0,sp,64
  ff60400082:	fca43c23          	sd	a0,-40(s0)
  ff60400086:	87ae                	mv	a5,a1
  ff60400088:	fcc43423          	sd	a2,-56(s0)
  ff6040008c:	fcf42a23          	sw	a5,-44(s0)
    void* ret = dst;
  ff60400090:	fd843783          	ld	a5,-40(s0)
  ff60400094:	fef43423          	sd	a5,-24(s0)
    while(count--)
  ff60400098:	a831                	j	ff604000b4 <memset+0x38>
    {
        *(char*)dst = (char)val;
  ff6040009a:	fd442783          	lw	a5,-44(s0)
  ff6040009e:	0ff7f713          	andi	a4,a5,255
  ff604000a2:	fd843783          	ld	a5,-40(s0)
  ff604000a6:	00e78023          	sb	a4,0(a5)
        dst = (char*)dst + 1;
  ff604000aa:	fd843783          	ld	a5,-40(s0)
  ff604000ae:	0785                	addi	a5,a5,1
  ff604000b0:	fcf43c23          	sd	a5,-40(s0)
    while(count--)
  ff604000b4:	fc843783          	ld	a5,-56(s0)
  ff604000b8:	fff78713          	addi	a4,a5,-1
  ff604000bc:	fce43423          	sd	a4,-56(s0)
  ff604000c0:	ffe9                	bnez	a5,ff6040009a <memset+0x1e>
    }
    return ret;
  ff604000c2:	fe843783          	ld	a5,-24(s0)
}
  ff604000c6:	853e                	mv	a0,a5
  ff604000c8:	7462                	ld	s0,56(sp)
  ff604000ca:	6121                	addi	sp,sp,64
  ff604000cc:	8082                	ret

000000ff604000ce <clk_enable>:

void clk_enable(uint8_t num)
{
  ff604000ce:	7179                	addi	sp,sp,-48
  ff604000d0:	f406                	sd	ra,40(sp)
  ff604000d2:	f022                	sd	s0,32(sp)
  ff604000d4:	1800                	addi	s0,sp,48
  ff604000d6:	87aa                	mv	a5,a0
  ff604000d8:	fcf40fa3          	sb	a5,-33(s0)
    uint32_t var;

    if (num > 2)
  ff604000dc:	fdf44783          	lbu	a5,-33(s0)
  ff604000e0:	0ff7f713          	andi	a4,a5,255
  ff604000e4:	4789                	li	a5,2
  ff604000e6:	04e7e863          	bltu	a5,a4,ff60400136 <clk_enable+0x68>
        return;

    var = readl(SW_RST_CFG0);
  ff604000ea:	7fb00793          	li	a5,2043
  ff604000ee:	07f6                	slli	a5,a5,0x1d
  ff604000f0:	13078513          	addi	a0,a5,304
  ff604000f4:	f2fff0ef          	jal	ra,ff60400022 <__raw_readl>
  ff604000f8:	87aa                	mv	a5,a0
  ff604000fa:	fef42623          	sw	a5,-20(s0)
    var &= ~(1 << num);
  ff604000fe:	fdf44783          	lbu	a5,-33(s0)
  ff60400102:	2781                	sext.w	a5,a5
  ff60400104:	4705                	li	a4,1
  ff60400106:	00f717bb          	sllw	a5,a4,a5
  ff6040010a:	2781                	sext.w	a5,a5
  ff6040010c:	fff7c793          	not	a5,a5
  ff60400110:	2781                	sext.w	a5,a5
  ff60400112:	0007871b          	sext.w	a4,a5
  ff60400116:	fec42783          	lw	a5,-20(s0)
  ff6040011a:	8ff9                	and	a5,a5,a4
  ff6040011c:	fef42623          	sw	a5,-20(s0)
    writel(SW_RST_CFG0, var);
  ff60400120:	fec42703          	lw	a4,-20(s0)
  ff60400124:	7fb00793          	li	a5,2043
  ff60400128:	07f6                	slli	a5,a5,0x1d
  ff6040012a:	13078593          	addi	a1,a5,304
  ff6040012e:	853a                	mv	a0,a4
  ff60400130:	ed1ff0ef          	jal	ra,ff60400000 <__raw_writel>
  ff60400134:	a011                	j	ff60400138 <clk_enable+0x6a>
        return;
  ff60400136:	0001                	nop
}
  ff60400138:	70a2                	ld	ra,40(sp)
  ff6040013a:	7402                	ld	s0,32(sp)
  ff6040013c:	6145                	addi	sp,sp,48
  ff6040013e:	8082                	ret

000000ff60400140 <__raw_writel>:
{
  ff60400140:	1101                	addi	sp,sp,-32
  ff60400142:	ec22                	sd	s0,24(sp)
  ff60400144:	1000                	addi	s0,sp,32
  ff60400146:	87aa                	mv	a5,a0
  ff60400148:	feb43023          	sd	a1,-32(s0)
  ff6040014c:	fef42623          	sw	a5,-20(s0)
        asm volatile("sw %0, 0(%1)" : : "r" (v), "r" (a));
  ff60400150:	fec42783          	lw	a5,-20(s0)
  ff60400154:	fe043703          	ld	a4,-32(s0)
  ff60400158:	c31c                	sw	a5,0(a4)
}
  ff6040015a:	0001                	nop
  ff6040015c:	6462                	ld	s0,24(sp)
  ff6040015e:	6105                	addi	sp,sp,32
  ff60400160:	8082                	ret

000000ff60400162 <__raw_readl>:
{
  ff60400162:	7179                	addi	sp,sp,-48
  ff60400164:	f422                	sd	s0,40(sp)
  ff60400166:	1800                	addi	s0,sp,48
  ff60400168:	fca43c23          	sd	a0,-40(s0)
        asm volatile("lw %0, 0(%1)" : "=r" (v) : "r" (a));
  ff6040016c:	fd843783          	ld	a5,-40(s0)
  ff60400170:	439c                	lw	a5,0(a5)
  ff60400172:	fef42623          	sw	a5,-20(s0)
            return v;
  ff60400176:	fec42783          	lw	a5,-20(s0)
}
  ff6040017a:	853e                	mv	a0,a5
  ff6040017c:	7422                	ld	s0,40(sp)
  ff6040017e:	6145                	addi	sp,sp,48
  ff60400180:	8082                	ret

000000ff60400182 <dw_pcie_dbi_ro_wr_en>:
void dw_pcie_disable_atu(struct dw_pcie *pci, int index,
			 enum dw_pcie_region_type type);
void dw_pcie_setup(struct dw_pcie *pci);

static inline void dw_pcie_dbi_ro_wr_en(struct dw_pcie *pci)
{
  ff60400182:	7179                	addi	sp,sp,-48
  ff60400184:	f406                	sd	ra,40(sp)
  ff60400186:	f022                	sd	s0,32(sp)
  ff60400188:	1800                	addi	s0,sp,48
  ff6040018a:	fca43c23          	sd	a0,-40(s0)
	uint32_t reg;
	uint32_t val;

	reg = PCIE_MISC_CONTROL_1_OFF;
  ff6040018e:	6785                	lui	a5,0x1
  ff60400190:	8bc78793          	addi	a5,a5,-1860 # 8bc <__raw_writel-0xff603ff744>
  ff60400194:	fef42623          	sw	a5,-20(s0)
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, reg, 0x4);
  ff60400198:	fec42783          	lw	a5,-20(s0)
  ff6040019c:	4691                	li	a3,4
  ff6040019e:	863e                	mv	a2,a5
  ff604001a0:	4581                	li	a1,0
  ff604001a2:	fd843503          	ld	a0,-40(s0)
  ff604001a6:	31c000ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff604001aa:	87aa                	mv	a5,a0
  ff604001ac:	fef42423          	sw	a5,-24(s0)
	val |= PCIE_DBI_RO_WR_EN;
  ff604001b0:	fe842783          	lw	a5,-24(s0)
  ff604001b4:	0017e793          	ori	a5,a5,1
  ff604001b8:	fef42423          	sw	a5,-24(s0)
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, reg, val, 0x4);
  ff604001bc:	fe842683          	lw	a3,-24(s0)
  ff604001c0:	fec42783          	lw	a5,-20(s0)
  ff604001c4:	4711                	li	a4,4
  ff604001c6:	863e                	mv	a2,a5
  ff604001c8:	4581                	li	a1,0
  ff604001ca:	fd843503          	ld	a0,-40(s0)
  ff604001ce:	5dc000ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
}
  ff604001d2:	0001                	nop
  ff604001d4:	70a2                	ld	ra,40(sp)
  ff604001d6:	7402                	ld	s0,32(sp)
  ff604001d8:	6145                	addi	sp,sp,48
  ff604001da:	8082                	ret

000000ff604001dc <dw_pcie_dbi_ro_wr_dis>:

static inline void dw_pcie_dbi_ro_wr_dis(struct dw_pcie *pci)
{
  ff604001dc:	7179                	addi	sp,sp,-48
  ff604001de:	f406                	sd	ra,40(sp)
  ff604001e0:	f022                	sd	s0,32(sp)
  ff604001e2:	1800                	addi	s0,sp,48
  ff604001e4:	fca43c23          	sd	a0,-40(s0)
	uint32_t reg;
	uint32_t val;

	reg = PCIE_MISC_CONTROL_1_OFF;
  ff604001e8:	6785                	lui	a5,0x1
  ff604001ea:	8bc78793          	addi	a5,a5,-1860 # 8bc <__raw_writel-0xff603ff744>
  ff604001ee:	fef42623          	sw	a5,-20(s0)
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, reg, 0x4);
  ff604001f2:	fec42783          	lw	a5,-20(s0)
  ff604001f6:	4691                	li	a3,4
  ff604001f8:	863e                	mv	a2,a5
  ff604001fa:	4581                	li	a1,0
  ff604001fc:	fd843503          	ld	a0,-40(s0)
  ff60400200:	2c2000ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400204:	87aa                	mv	a5,a0
  ff60400206:	fef42423          	sw	a5,-24(s0)
	val &= ~PCIE_DBI_RO_WR_EN;
  ff6040020a:	fe842783          	lw	a5,-24(s0)
  ff6040020e:	9bf9                	andi	a5,a5,-2
  ff60400210:	fef42423          	sw	a5,-24(s0)
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, reg, val, 0x4);
  ff60400214:	fe842683          	lw	a3,-24(s0)
  ff60400218:	fec42783          	lw	a5,-20(s0)
  ff6040021c:	4711                	li	a4,4
  ff6040021e:	863e                	mv	a2,a5
  ff60400220:	4581                	li	a1,0
  ff60400222:	fd843503          	ld	a0,-40(s0)
  ff60400226:	584000ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
}
  ff6040022a:	0001                	nop
  ff6040022c:	70a2                	ld	ra,40(sp)
  ff6040022e:	7402                	ld	s0,32(sp)
  ff60400230:	6145                	addi	sp,sp,48
  ff60400232:	8082                	ret

000000ff60400234 <axi_read_c>:
#ifdef IPBENCH
void axi_read_c(uint64_t addr, uint32_t *data, int port);
void axi_write_c(uint64_t addr, uint32_t data, int port);
#else
uint32_t axi_read_c(uint64_t addr, uint8_t port)
{
  ff60400234:	1101                	addi	sp,sp,-32
  ff60400236:	ec22                	sd	s0,24(sp)
  ff60400238:	1000                	addi	s0,sp,32
  ff6040023a:	fea43423          	sd	a0,-24(s0)
  ff6040023e:	87ae                	mv	a5,a1
  ff60400240:	fef403a3          	sb	a5,-25(s0)
    return 0;
  ff60400244:	4781                	li	a5,0
}
  ff60400246:	853e                	mv	a0,a5
  ff60400248:	6462                	ld	s0,24(sp)
  ff6040024a:	6105                	addi	sp,sp,32
  ff6040024c:	8082                	ret

000000ff6040024e <axi_write_c>:

void axi_write_c(uint64_t addr, uint32_t val, uint8_t port)
{
  ff6040024e:	1101                	addi	sp,sp,-32
  ff60400250:	ec06                	sd	ra,24(sp)
  ff60400252:	e822                	sd	s0,16(sp)
  ff60400254:	1000                	addi	s0,sp,32
  ff60400256:	fea43423          	sd	a0,-24(s0)
  ff6040025a:	87ae                	mv	a5,a1
  ff6040025c:	8732                	mv	a4,a2
  ff6040025e:	fef42223          	sw	a5,-28(s0)
  ff60400262:	87ba                	mv	a5,a4
  ff60400264:	fef401a3          	sb	a5,-29(s0)
    printf("WriteAXI: addr: 0x%08x, data: 0x%08x, port: %d\n", addr, val, port);
  ff60400268:	fe344783          	lbu	a5,-29(s0)
  ff6040026c:	0007871b          	sext.w	a4,a5
  ff60400270:	fe442783          	lw	a5,-28(s0)
  ff60400274:	86ba                	mv	a3,a4
  ff60400276:	863e                	mv	a2,a5
  ff60400278:	fe843583          	ld	a1,-24(s0)
  ff6040027c:	00002517          	auipc	a0,0x2
  ff60400280:	d8450513          	addi	a0,a0,-636 # ff60402000 <etext>
  ff60400284:	dbfff0ef          	jal	ra,ff60400042 <printf>
}
  ff60400288:	0001                	nop
  ff6040028a:	60e2                	ld	ra,24(sp)
  ff6040028c:	6442                	ld	s0,16(sp)
  ff6040028e:	6105                	addi	sp,sp,32
  ff60400290:	8082                	ret

000000ff60400292 <format_dbi_addr>:
#endif


static uint64_t format_dbi_addr(enum dw_pcie_access_type type, uint32_t reg)
{
  ff60400292:	7179                	addi	sp,sp,-48
  ff60400294:	f406                	sd	ra,40(sp)
  ff60400296:	f022                	sd	s0,32(sp)
  ff60400298:	1800                	addi	s0,sp,48
  ff6040029a:	87aa                	mv	a5,a0
  ff6040029c:	872e                	mv	a4,a1
  ff6040029e:	fcf42e23          	sw	a5,-36(s0)
  ff604002a2:	87ba                	mv	a5,a4
  ff604002a4:	fcf42c23          	sw	a5,-40(s0)
    //uint64_t route0, route1, addr;
    uint32_t route1, addr;

    //assert(reg & 0x3 == 0);
 
    switch (type) {
  ff604002a8:	fdc42783          	lw	a5,-36(s0)
  ff604002ac:	0007871b          	sext.w	a4,a5
  ff604002b0:	4791                	li	a5,4
  ff604002b2:	04f70e63          	beq	a4,a5,ff6040030e <format_dbi_addr+0x7c>
  ff604002b6:	fdc42783          	lw	a5,-36(s0)
  ff604002ba:	0007871b          	sext.w	a4,a5
  ff604002be:	4791                	li	a5,4
  ff604002c0:	04e7eb63          	bltu	a5,a4,ff60400316 <format_dbi_addr+0x84>
  ff604002c4:	fdc42783          	lw	a5,-36(s0)
  ff604002c8:	0007871b          	sext.w	a4,a5
  ff604002cc:	478d                	li	a5,3
  ff604002ce:	02f70c63          	beq	a4,a5,ff60400306 <format_dbi_addr+0x74>
  ff604002d2:	fdc42783          	lw	a5,-36(s0)
  ff604002d6:	0007871b          	sext.w	a4,a5
  ff604002da:	478d                	li	a5,3
  ff604002dc:	02e7ed63          	bltu	a5,a4,ff60400316 <format_dbi_addr+0x84>
  ff604002e0:	fdc42783          	lw	a5,-36(s0)
  ff604002e4:	2781                	sext.w	a5,a5
  ff604002e6:	cb89                	beqz	a5,ff604002f8 <format_dbi_addr+0x66>
  ff604002e8:	fdc42783          	lw	a5,-36(s0)
  ff604002ec:	0007871b          	sext.w	a4,a5
  ff604002f0:	4785                	li	a5,1
  ff604002f2:	00f70663          	beq	a4,a5,ff604002fe <format_dbi_addr+0x6c>
  ff604002f6:	a005                	j	ff60400316 <format_dbi_addr+0x84>
    case DW_PCIE_CDM:
        //route0 = 0;
        route1 = 0;
  ff604002f8:	fe042623          	sw	zero,-20(s0)
        break;
  ff604002fc:	a035                	j	ff60400328 <format_dbi_addr+0x96>
    case DW_PCIE_SHADOW:
        //route0 = 1;
        route1 = 1;
  ff604002fe:	4785                	li	a5,1
  ff60400300:	fef42623          	sw	a5,-20(s0)
        break;
  ff60400304:	a015                	j	ff60400328 <format_dbi_addr+0x96>
    case DW_PCIE_ATU:
        //route0 = 3;
        route1 = 2;
  ff60400306:	4789                	li	a5,2
  ff60400308:	fef42623          	sw	a5,-20(s0)
        break;
  ff6040030c:	a831                	j	ff60400328 <format_dbi_addr+0x96>
    case DW_PCIE_DMA:
        //route0 = 3;
        route1 = 3;
  ff6040030e:	478d                	li	a5,3
  ff60400310:	fef42623          	sw	a5,-20(s0)
        break;
  ff60400314:	a811                	j	ff60400328 <format_dbi_addr+0x96>
    default:
        dev_err(pci->dev, "Other types is not supported\n");
  ff60400316:	00002517          	auipc	a0,0x2
  ff6040031a:	d1a50513          	addi	a0,a0,-742 # ff60402030 <etext+0x30>
  ff6040031e:	d25ff0ef          	jal	ra,ff60400042 <printf>
        return 0xffffffff;
  ff60400322:	57fd                	li	a5,-1
  ff60400324:	9381                	srli	a5,a5,0x20
  ff60400326:	a831                	j	ff60400342 <format_dbi_addr+0xb0>
    }

    //addr = (route0 << 31) | (route1 << 17) | (uint64_t)reg;
    addr = (route1 << 17) | reg;
  ff60400328:	fec42783          	lw	a5,-20(s0)
  ff6040032c:	0117979b          	slliw	a5,a5,0x11
  ff60400330:	0007871b          	sext.w	a4,a5
  ff60400334:	fd842783          	lw	a5,-40(s0)
  ff60400338:	8fd9                	or	a5,a5,a4
  ff6040033a:	fef42423          	sw	a5,-24(s0)
    return addr;
  ff6040033e:	fe846783          	lwu	a5,-24(s0)
}
  ff60400342:	853e                	mv	a0,a5
  ff60400344:	70a2                	ld	ra,40(sp)
  ff60400346:	7402                	ld	s0,32(sp)
  ff60400348:	6145                	addi	sp,sp,48
  ff6040034a:	8082                	ret

000000ff6040034c <read_dbi>:

static uint32_t read_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg)
{
  ff6040034c:	7179                	addi	sp,sp,-48
  ff6040034e:	f406                	sd	ra,40(sp)
  ff60400350:	f022                	sd	s0,32(sp)
  ff60400352:	1800                	addi	s0,sp,48
  ff60400354:	fca43c23          	sd	a0,-40(s0)
  ff60400358:	87ae                	mv	a5,a1
  ff6040035a:	8732                	mv	a4,a2
  ff6040035c:	fcf42a23          	sw	a5,-44(s0)
  ff60400360:	87ba                	mv	a5,a4
  ff60400362:	fcf42823          	sw	a5,-48(s0)
    uint32_t val;
    uint64_t dbi_offset;
    
    dbi_offset = format_dbi_addr(type, reg);
  ff60400366:	fd042703          	lw	a4,-48(s0)
  ff6040036a:	fd442783          	lw	a5,-44(s0)
  ff6040036e:	85ba                	mv	a1,a4
  ff60400370:	853e                	mv	a0,a5
  ff60400372:	f21ff0ef          	jal	ra,ff60400292 <format_dbi_addr>
  ff60400376:	fea43423          	sd	a0,-24(s0)
#ifdef IPBENCH
    axi_read_c((pci->dbi_base + dbi_offset), &val, pci->axi_dbi_port);
#else
    val = readl(pci->dbi_base + dbi_offset);
  ff6040037a:	fd843783          	ld	a5,-40(s0)
  ff6040037e:	6798                	ld	a4,8(a5)
  ff60400380:	fe843783          	ld	a5,-24(s0)
  ff60400384:	97ba                	add	a5,a5,a4
  ff60400386:	853e                	mv	a0,a5
  ff60400388:	ddbff0ef          	jal	ra,ff60400162 <__raw_readl>
  ff6040038c:	87aa                	mv	a5,a0
  ff6040038e:	fef42223          	sw	a5,-28(s0)
#endif

	return val;
  ff60400392:	fe442783          	lw	a5,-28(s0)
}
  ff60400396:	853e                	mv	a0,a5
  ff60400398:	70a2                	ld	ra,40(sp)
  ff6040039a:	7402                	ld	s0,32(sp)
  ff6040039c:	6145                	addi	sp,sp,48
  ff6040039e:	8082                	ret

000000ff604003a0 <readl_dbi>:

uint32_t readl_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg)
{
  ff604003a0:	7179                	addi	sp,sp,-48
  ff604003a2:	f406                	sd	ra,40(sp)
  ff604003a4:	f022                	sd	s0,32(sp)
  ff604003a6:	1800                	addi	s0,sp,48
  ff604003a8:	fca43c23          	sd	a0,-40(s0)
  ff604003ac:	87ae                	mv	a5,a1
  ff604003ae:	8732                	mv	a4,a2
  ff604003b0:	fcf42a23          	sw	a5,-44(s0)
  ff604003b4:	87ba                	mv	a5,a4
  ff604003b6:	fcf42823          	sw	a5,-48(s0)
    uint32_t val;

    val = read_dbi(pci, type, reg);
  ff604003ba:	fd042703          	lw	a4,-48(s0)
  ff604003be:	fd442783          	lw	a5,-44(s0)
  ff604003c2:	863a                	mv	a2,a4
  ff604003c4:	85be                	mv	a1,a5
  ff604003c6:	fd843503          	ld	a0,-40(s0)
  ff604003ca:	f83ff0ef          	jal	ra,ff6040034c <read_dbi>
  ff604003ce:	87aa                	mv	a5,a0
  ff604003d0:	fef42623          	sw	a5,-20(s0)

    return val;
  ff604003d4:	fec42783          	lw	a5,-20(s0)
}
  ff604003d8:	853e                	mv	a0,a5
  ff604003da:	70a2                	ld	ra,40(sp)
  ff604003dc:	7402                	ld	s0,32(sp)
  ff604003de:	6145                	addi	sp,sp,48
  ff604003e0:	8082                	ret

000000ff604003e2 <readw_dbi>:

uint16_t readw_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint16_t reg)
{
  ff604003e2:	7179                	addi	sp,sp,-48
  ff604003e4:	f406                	sd	ra,40(sp)
  ff604003e6:	f022                	sd	s0,32(sp)
  ff604003e8:	1800                	addi	s0,sp,48
  ff604003ea:	fca43c23          	sd	a0,-40(s0)
  ff604003ee:	87ae                	mv	a5,a1
  ff604003f0:	8732                	mv	a4,a2
  ff604003f2:	fcf42a23          	sw	a5,-44(s0)
  ff604003f6:	87ba                	mv	a5,a4
  ff604003f8:	fcf41923          	sh	a5,-46(s0)
    uint32_t val;
    uint8_t shift;

    shift = (reg & 0x2);
  ff604003fc:	fd245783          	lhu	a5,-46(s0)
  ff60400400:	0ff7f793          	andi	a5,a5,255
  ff60400404:	8b89                	andi	a5,a5,2
  ff60400406:	fef407a3          	sb	a5,-17(s0)
    val = read_dbi(pci, type, reg);
  ff6040040a:	fd245783          	lhu	a5,-46(s0)
  ff6040040e:	0007871b          	sext.w	a4,a5
  ff60400412:	fd442783          	lw	a5,-44(s0)
  ff60400416:	863a                	mv	a2,a4
  ff60400418:	85be                	mv	a1,a5
  ff6040041a:	fd843503          	ld	a0,-40(s0)
  ff6040041e:	f2fff0ef          	jal	ra,ff6040034c <read_dbi>
  ff60400422:	87aa                	mv	a5,a0
  ff60400424:	fef42423          	sw	a5,-24(s0)
    val = val >> (8 * shift);
  ff60400428:	fef44783          	lbu	a5,-17(s0)
  ff6040042c:	2781                	sext.w	a5,a5
  ff6040042e:	0037979b          	slliw	a5,a5,0x3
  ff60400432:	2781                	sext.w	a5,a5
  ff60400434:	873e                	mv	a4,a5
  ff60400436:	fe842783          	lw	a5,-24(s0)
  ff6040043a:	00e7d7bb          	srlw	a5,a5,a4
  ff6040043e:	fef42423          	sw	a5,-24(s0)

    return (uint16_t)val;
  ff60400442:	fe842783          	lw	a5,-24(s0)
  ff60400446:	17c2                	slli	a5,a5,0x30
  ff60400448:	93c1                	srli	a5,a5,0x30
}
  ff6040044a:	853e                	mv	a0,a5
  ff6040044c:	70a2                	ld	ra,40(sp)
  ff6040044e:	7402                	ld	s0,32(sp)
  ff60400450:	6145                	addi	sp,sp,48
  ff60400452:	8082                	ret

000000ff60400454 <readb_dbi>:

uint8_t readb_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint8_t reg)
{
  ff60400454:	7179                	addi	sp,sp,-48
  ff60400456:	f406                	sd	ra,40(sp)
  ff60400458:	f022                	sd	s0,32(sp)
  ff6040045a:	1800                	addi	s0,sp,48
  ff6040045c:	fca43c23          	sd	a0,-40(s0)
  ff60400460:	87ae                	mv	a5,a1
  ff60400462:	8732                	mv	a4,a2
  ff60400464:	fcf42a23          	sw	a5,-44(s0)
  ff60400468:	87ba                	mv	a5,a4
  ff6040046a:	fcf409a3          	sb	a5,-45(s0)
    uint32_t val;
    uint8_t shift;

    shift = (reg & 0x3);
  ff6040046e:	fd344783          	lbu	a5,-45(s0)
  ff60400472:	8b8d                	andi	a5,a5,3
  ff60400474:	fef407a3          	sb	a5,-17(s0)
    val = read_dbi(pci, type, reg);
  ff60400478:	fd344783          	lbu	a5,-45(s0)
  ff6040047c:	0007871b          	sext.w	a4,a5
  ff60400480:	fd442783          	lw	a5,-44(s0)
  ff60400484:	863a                	mv	a2,a4
  ff60400486:	85be                	mv	a1,a5
  ff60400488:	fd843503          	ld	a0,-40(s0)
  ff6040048c:	ec1ff0ef          	jal	ra,ff6040034c <read_dbi>
  ff60400490:	87aa                	mv	a5,a0
  ff60400492:	fef42423          	sw	a5,-24(s0)
    val = val >> (8 * shift);
  ff60400496:	fef44783          	lbu	a5,-17(s0)
  ff6040049a:	2781                	sext.w	a5,a5
  ff6040049c:	0037979b          	slliw	a5,a5,0x3
  ff604004a0:	2781                	sext.w	a5,a5
  ff604004a2:	873e                	mv	a4,a5
  ff604004a4:	fe842783          	lw	a5,-24(s0)
  ff604004a8:	00e7d7bb          	srlw	a5,a5,a4
  ff604004ac:	fef42423          	sw	a5,-24(s0)

    return (uint8_t)val;
  ff604004b0:	fe842783          	lw	a5,-24(s0)
  ff604004b4:	0ff7f793          	andi	a5,a5,255
}
  ff604004b8:	853e                	mv	a0,a5
  ff604004ba:	70a2                	ld	ra,40(sp)
  ff604004bc:	7402                	ld	s0,32(sp)
  ff604004be:	6145                	addi	sp,sp,48
  ff604004c0:	8082                	ret

000000ff604004c2 <dw_pcie_read_dbi>:

uint32_t dw_pcie_read_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg, size_t size)
{
  ff604004c2:	7139                	addi	sp,sp,-64
  ff604004c4:	fc06                	sd	ra,56(sp)
  ff604004c6:	f822                	sd	s0,48(sp)
  ff604004c8:	0080                	addi	s0,sp,64
  ff604004ca:	fca43c23          	sd	a0,-40(s0)
  ff604004ce:	87ae                	mv	a5,a1
  ff604004d0:	8732                	mv	a4,a2
  ff604004d2:	fcd43423          	sd	a3,-56(s0)
  ff604004d6:	fcf42a23          	sw	a5,-44(s0)
  ff604004da:	87ba                	mv	a5,a4
  ff604004dc:	fcf42823          	sw	a5,-48(s0)
    uint32_t val;

    switch (size) {
  ff604004e0:	fc843703          	ld	a4,-56(s0)
  ff604004e4:	4785                	li	a5,1
  ff604004e6:	00f70863          	beq	a4,a5,ff604004f6 <dw_pcie_read_dbi+0x34>
  ff604004ea:	fc843703          	ld	a4,-56(s0)
  ff604004ee:	4789                	li	a5,2
  ff604004f0:	02f70363          	beq	a4,a5,ff60400516 <dw_pcie_read_dbi+0x54>
  ff604004f4:	a091                	j	ff60400538 <dw_pcie_read_dbi+0x76>
    case 1:
        val = readb_dbi(pci, type, reg);
  ff604004f6:	fd042783          	lw	a5,-48(s0)
  ff604004fa:	0ff7f713          	andi	a4,a5,255
  ff604004fe:	fd442783          	lw	a5,-44(s0)
  ff60400502:	863a                	mv	a2,a4
  ff60400504:	85be                	mv	a1,a5
  ff60400506:	fd843503          	ld	a0,-40(s0)
  ff6040050a:	f4bff0ef          	jal	ra,ff60400454 <readb_dbi>
  ff6040050e:	87aa                	mv	a5,a0
  ff60400510:	fef42623          	sw	a5,-20(s0)
        break;
  ff60400514:	a83d                	j	ff60400552 <dw_pcie_read_dbi+0x90>
    case 2:
        val = readw_dbi(pci, type, reg);
  ff60400516:	fd042783          	lw	a5,-48(s0)
  ff6040051a:	03079713          	slli	a4,a5,0x30
  ff6040051e:	9341                	srli	a4,a4,0x30
  ff60400520:	fd442783          	lw	a5,-44(s0)
  ff60400524:	863a                	mv	a2,a4
  ff60400526:	85be                	mv	a1,a5
  ff60400528:	fd843503          	ld	a0,-40(s0)
  ff6040052c:	eb7ff0ef          	jal	ra,ff604003e2 <readw_dbi>
  ff60400530:	87aa                	mv	a5,a0
  ff60400532:	fef42623          	sw	a5,-20(s0)
        break;
  ff60400536:	a831                	j	ff60400552 <dw_pcie_read_dbi+0x90>
    case 4:
    default:
        val = readl_dbi(pci, type, reg);
  ff60400538:	fd042703          	lw	a4,-48(s0)
  ff6040053c:	fd442783          	lw	a5,-44(s0)
  ff60400540:	863a                	mv	a2,a4
  ff60400542:	85be                	mv	a1,a5
  ff60400544:	fd843503          	ld	a0,-40(s0)
  ff60400548:	e59ff0ef          	jal	ra,ff604003a0 <readl_dbi>
  ff6040054c:	87aa                	mv	a5,a0
  ff6040054e:	fef42623          	sw	a5,-20(s0)
    }

    return val;
  ff60400552:	fec42783          	lw	a5,-20(s0)
}
  ff60400556:	853e                	mv	a0,a5
  ff60400558:	70e2                	ld	ra,56(sp)
  ff6040055a:	7442                	ld	s0,48(sp)
  ff6040055c:	6121                	addi	sp,sp,64
  ff6040055e:	8082                	ret

000000ff60400560 <write_dbi>:

static void write_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg, uint32_t val)
{
  ff60400560:	7139                	addi	sp,sp,-64
  ff60400562:	fc06                	sd	ra,56(sp)
  ff60400564:	f822                	sd	s0,48(sp)
  ff60400566:	0080                	addi	s0,sp,64
  ff60400568:	fca43c23          	sd	a0,-40(s0)
  ff6040056c:	87ae                	mv	a5,a1
  ff6040056e:	8736                	mv	a4,a3
  ff60400570:	fcf42a23          	sw	a5,-44(s0)
  ff60400574:	87b2                	mv	a5,a2
  ff60400576:	fcf42823          	sw	a5,-48(s0)
  ff6040057a:	87ba                	mv	a5,a4
  ff6040057c:	fcf42623          	sw	a5,-52(s0)
    uint64_t dbi_offset;

    dbi_offset = format_dbi_addr(type, reg);
  ff60400580:	fd042703          	lw	a4,-48(s0)
  ff60400584:	fd442783          	lw	a5,-44(s0)
  ff60400588:	85ba                	mv	a1,a4
  ff6040058a:	853e                	mv	a0,a5
  ff6040058c:	d07ff0ef          	jal	ra,ff60400292 <format_dbi_addr>
  ff60400590:	fea43423          	sd	a0,-24(s0)

#ifdef IPBENCH
    axi_write_c(pci->dbi_base + dbi_offset, val, pci->axi_dbi_port);
#else
    printf("AXIWrite: Addr: 0x%llx, Data: 0x%x\n", pci->dbi_base + dbi_offset, val);
  ff60400594:	fd843783          	ld	a5,-40(s0)
  ff60400598:	6798                	ld	a4,8(a5)
  ff6040059a:	fe843783          	ld	a5,-24(s0)
  ff6040059e:	97ba                	add	a5,a5,a4
  ff604005a0:	fcc42703          	lw	a4,-52(s0)
  ff604005a4:	863a                	mv	a2,a4
  ff604005a6:	85be                	mv	a1,a5
  ff604005a8:	00002517          	auipc	a0,0x2
  ff604005ac:	aa850513          	addi	a0,a0,-1368 # ff60402050 <etext+0x50>
  ff604005b0:	a93ff0ef          	jal	ra,ff60400042 <printf>
    writel(pci->dbi_base + dbi_offset, val);
  ff604005b4:	fd843783          	ld	a5,-40(s0)
  ff604005b8:	6798                	ld	a4,8(a5)
  ff604005ba:	fe843783          	ld	a5,-24(s0)
  ff604005be:	973e                	add	a4,a4,a5
  ff604005c0:	fcc42783          	lw	a5,-52(s0)
  ff604005c4:	85ba                	mv	a1,a4
  ff604005c6:	853e                	mv	a0,a5
  ff604005c8:	b79ff0ef          	jal	ra,ff60400140 <__raw_writel>
#endif

}
  ff604005cc:	0001                	nop
  ff604005ce:	70e2                	ld	ra,56(sp)
  ff604005d0:	7442                	ld	s0,48(sp)
  ff604005d2:	6121                	addi	sp,sp,64
  ff604005d4:	8082                	ret

000000ff604005d6 <dw_pcie_writel_dbi>:

void dw_pcie_writel_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg, uint32_t val)
{
  ff604005d6:	7179                	addi	sp,sp,-48
  ff604005d8:	f406                	sd	ra,40(sp)
  ff604005da:	f022                	sd	s0,32(sp)
  ff604005dc:	1800                	addi	s0,sp,48
  ff604005de:	fea43423          	sd	a0,-24(s0)
  ff604005e2:	87ae                	mv	a5,a1
  ff604005e4:	8736                	mv	a4,a3
  ff604005e6:	fef42223          	sw	a5,-28(s0)
  ff604005ea:	87b2                	mv	a5,a2
  ff604005ec:	fef42023          	sw	a5,-32(s0)
  ff604005f0:	87ba                	mv	a5,a4
  ff604005f2:	fcf42e23          	sw	a5,-36(s0)
    write_dbi(pci, type, reg, val);
  ff604005f6:	fdc42683          	lw	a3,-36(s0)
  ff604005fa:	fe042703          	lw	a4,-32(s0)
  ff604005fe:	fe442783          	lw	a5,-28(s0)
  ff60400602:	863a                	mv	a2,a4
  ff60400604:	85be                	mv	a1,a5
  ff60400606:	fe843503          	ld	a0,-24(s0)
  ff6040060a:	f57ff0ef          	jal	ra,ff60400560 <write_dbi>
}
  ff6040060e:	0001                	nop
  ff60400610:	70a2                	ld	ra,40(sp)
  ff60400612:	7402                	ld	s0,32(sp)
  ff60400614:	6145                	addi	sp,sp,48
  ff60400616:	8082                	ret

000000ff60400618 <dw_pcie_writeb_dbi>:

void dw_pcie_writeb_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg, uint8_t val)
{
  ff60400618:	7139                	addi	sp,sp,-64
  ff6040061a:	fc06                	sd	ra,56(sp)
  ff6040061c:	f822                	sd	s0,48(sp)
  ff6040061e:	0080                	addi	s0,sp,64
  ff60400620:	fca43c23          	sd	a0,-40(s0)
  ff60400624:	87ae                	mv	a5,a1
  ff60400626:	8736                	mv	a4,a3
  ff60400628:	fcf42a23          	sw	a5,-44(s0)
  ff6040062c:	87b2                	mv	a5,a2
  ff6040062e:	fcf42823          	sw	a5,-48(s0)
  ff60400632:	87ba                	mv	a5,a4
  ff60400634:	fcf407a3          	sb	a5,-49(s0)
    uint32_t tmp, mask = 0xff;
  ff60400638:	0ff00793          	li	a5,255
  ff6040063c:	fef42623          	sw	a5,-20(s0)
    uint8_t shift;

    shift = (reg & 0x3);
  ff60400640:	fd042783          	lw	a5,-48(s0)
  ff60400644:	0ff7f793          	andi	a5,a5,255
  ff60400648:	8b8d                	andi	a5,a5,3
  ff6040064a:	fef405a3          	sb	a5,-21(s0)
    tmp = readl_dbi(pci, type, (reg & 0xfffffffc));
  ff6040064e:	fd042783          	lw	a5,-48(s0)
  ff60400652:	9bf1                	andi	a5,a5,-4
  ff60400654:	0007871b          	sext.w	a4,a5
  ff60400658:	fd442783          	lw	a5,-44(s0)
  ff6040065c:	863a                	mv	a2,a4
  ff6040065e:	85be                	mv	a1,a5
  ff60400660:	fd843503          	ld	a0,-40(s0)
  ff60400664:	d3dff0ef          	jal	ra,ff604003a0 <readl_dbi>
  ff60400668:	87aa                	mv	a5,a0
  ff6040066a:	fef42223          	sw	a5,-28(s0)
    mask = mask << (8 * shift);
  ff6040066e:	feb44783          	lbu	a5,-21(s0)
  ff60400672:	2781                	sext.w	a5,a5
  ff60400674:	0037979b          	slliw	a5,a5,0x3
  ff60400678:	2781                	sext.w	a5,a5
  ff6040067a:	873e                	mv	a4,a5
  ff6040067c:	fec42783          	lw	a5,-20(s0)
  ff60400680:	00e797bb          	sllw	a5,a5,a4
  ff60400684:	fef42623          	sw	a5,-20(s0)
    mask = ~mask;
  ff60400688:	fec42783          	lw	a5,-20(s0)
  ff6040068c:	fff7c793          	not	a5,a5
  ff60400690:	fef42623          	sw	a5,-20(s0)
    tmp = ((tmp & mask) | val << (8 * shift));
  ff60400694:	fe442703          	lw	a4,-28(s0)
  ff60400698:	fec42783          	lw	a5,-20(s0)
  ff6040069c:	8ff9                	and	a5,a5,a4
  ff6040069e:	0007869b          	sext.w	a3,a5
  ff604006a2:	fcf44783          	lbu	a5,-49(s0)
  ff604006a6:	0007871b          	sext.w	a4,a5
  ff604006aa:	feb44783          	lbu	a5,-21(s0)
  ff604006ae:	2781                	sext.w	a5,a5
  ff604006b0:	0037979b          	slliw	a5,a5,0x3
  ff604006b4:	2781                	sext.w	a5,a5
  ff604006b6:	00f717bb          	sllw	a5,a4,a5
  ff604006ba:	2781                	sext.w	a5,a5
  ff604006bc:	2781                	sext.w	a5,a5
  ff604006be:	8736                	mv	a4,a3
  ff604006c0:	8fd9                	or	a5,a5,a4
  ff604006c2:	fef42223          	sw	a5,-28(s0)

    write_dbi(pci, type, (reg & 0xfffffffc), tmp);
  ff604006c6:	fd042783          	lw	a5,-48(s0)
  ff604006ca:	9bf1                	andi	a5,a5,-4
  ff604006cc:	0007871b          	sext.w	a4,a5
  ff604006d0:	fe442683          	lw	a3,-28(s0)
  ff604006d4:	fd442783          	lw	a5,-44(s0)
  ff604006d8:	863a                	mv	a2,a4
  ff604006da:	85be                	mv	a1,a5
  ff604006dc:	fd843503          	ld	a0,-40(s0)
  ff604006e0:	e81ff0ef          	jal	ra,ff60400560 <write_dbi>
}
  ff604006e4:	0001                	nop
  ff604006e6:	70e2                	ld	ra,56(sp)
  ff604006e8:	7442                	ld	s0,48(sp)
  ff604006ea:	6121                	addi	sp,sp,64
  ff604006ec:	8082                	ret

000000ff604006ee <dw_pcie_writew_dbi>:

void dw_pcie_writew_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t reg, uint16_t val)
{
  ff604006ee:	7139                	addi	sp,sp,-64
  ff604006f0:	fc06                	sd	ra,56(sp)
  ff604006f2:	f822                	sd	s0,48(sp)
  ff604006f4:	0080                	addi	s0,sp,64
  ff604006f6:	fca43c23          	sd	a0,-40(s0)
  ff604006fa:	87ae                	mv	a5,a1
  ff604006fc:	8736                	mv	a4,a3
  ff604006fe:	fcf42a23          	sw	a5,-44(s0)
  ff60400702:	87b2                	mv	a5,a2
  ff60400704:	fcf42823          	sw	a5,-48(s0)
  ff60400708:	87ba                	mv	a5,a4
  ff6040070a:	fcf41723          	sh	a5,-50(s0)
    uint32_t tmp;
    uint8_t shift;

    shift = (reg & 0x2);
  ff6040070e:	fd042783          	lw	a5,-48(s0)
  ff60400712:	0ff7f793          	andi	a5,a5,255
  ff60400716:	8b89                	andi	a5,a5,2
  ff60400718:	fef407a3          	sb	a5,-17(s0)
    tmp = readl_dbi(pci, type, (reg & 0xfffffffc));
  ff6040071c:	fd042783          	lw	a5,-48(s0)
  ff60400720:	9bf1                	andi	a5,a5,-4
  ff60400722:	0007871b          	sext.w	a4,a5
  ff60400726:	fd442783          	lw	a5,-44(s0)
  ff6040072a:	863a                	mv	a2,a4
  ff6040072c:	85be                	mv	a1,a5
  ff6040072e:	fd843503          	ld	a0,-40(s0)
  ff60400732:	c6fff0ef          	jal	ra,ff604003a0 <readl_dbi>
  ff60400736:	87aa                	mv	a5,a0
  ff60400738:	fef42423          	sw	a5,-24(s0)
    tmp = (tmp & (0xffff0000 >> (shift * 8))) | (val << (shift * 8));
  ff6040073c:	fef44783          	lbu	a5,-17(s0)
  ff60400740:	2781                	sext.w	a5,a5
  ff60400742:	0037979b          	slliw	a5,a5,0x3
  ff60400746:	2781                	sext.w	a5,a5
  ff60400748:	873e                	mv	a4,a5
  ff6040074a:	77c1                	lui	a5,0xffff0
  ff6040074c:	00e7d7bb          	srlw	a5,a5,a4
  ff60400750:	0007871b          	sext.w	a4,a5
  ff60400754:	fe842783          	lw	a5,-24(s0)
  ff60400758:	8ff9                	and	a5,a5,a4
  ff6040075a:	0007869b          	sext.w	a3,a5
  ff6040075e:	fce45783          	lhu	a5,-50(s0)
  ff60400762:	0007871b          	sext.w	a4,a5
  ff60400766:	fef44783          	lbu	a5,-17(s0)
  ff6040076a:	2781                	sext.w	a5,a5
  ff6040076c:	0037979b          	slliw	a5,a5,0x3
  ff60400770:	2781                	sext.w	a5,a5
  ff60400772:	00f717bb          	sllw	a5,a4,a5
  ff60400776:	2781                	sext.w	a5,a5
  ff60400778:	2781                	sext.w	a5,a5
  ff6040077a:	8736                	mv	a4,a3
  ff6040077c:	8fd9                	or	a5,a5,a4
  ff6040077e:	fef42423          	sw	a5,-24(s0)

    write_dbi(pci, type, (reg & 0xfffffffc), tmp);
  ff60400782:	fd042783          	lw	a5,-48(s0)
  ff60400786:	9bf1                	andi	a5,a5,-4
  ff60400788:	0007871b          	sext.w	a4,a5
  ff6040078c:	fe842683          	lw	a3,-24(s0)
  ff60400790:	fd442783          	lw	a5,-44(s0)
  ff60400794:	863a                	mv	a2,a4
  ff60400796:	85be                	mv	a1,a5
  ff60400798:	fd843503          	ld	a0,-40(s0)
  ff6040079c:	dc5ff0ef          	jal	ra,ff60400560 <write_dbi>
}
  ff604007a0:	0001                	nop
  ff604007a2:	70e2                	ld	ra,56(sp)
  ff604007a4:	7442                	ld	s0,48(sp)
  ff604007a6:	6121                	addi	sp,sp,64
  ff604007a8:	8082                	ret

000000ff604007aa <dw_pcie_write_dbi>:

void dw_pcie_write_dbi(struct dw_pcie *pci, enum dw_pcie_access_type type, uint32_t addr, uint32_t val, size_t size)
{
  ff604007aa:	7179                	addi	sp,sp,-48
  ff604007ac:	f406                	sd	ra,40(sp)
  ff604007ae:	f022                	sd	s0,32(sp)
  ff604007b0:	1800                	addi	s0,sp,48
  ff604007b2:	fea43423          	sd	a0,-24(s0)
  ff604007b6:	87ae                	mv	a5,a1
  ff604007b8:	fce43823          	sd	a4,-48(s0)
  ff604007bc:	fef42223          	sw	a5,-28(s0)
  ff604007c0:	87b2                	mv	a5,a2
  ff604007c2:	fef42023          	sw	a5,-32(s0)
  ff604007c6:	87b6                	mv	a5,a3
  ff604007c8:	fcf42e23          	sw	a5,-36(s0)
    switch (size) {
  ff604007cc:	fd043703          	ld	a4,-48(s0)
  ff604007d0:	4791                	li	a5,4
  ff604007d2:	06f70163          	beq	a4,a5,ff60400834 <dw_pcie_write_dbi+0x8a>
  ff604007d6:	fd043703          	ld	a4,-48(s0)
  ff604007da:	4791                	li	a5,4
  ff604007dc:	06e7e963          	bltu	a5,a4,ff6040084e <dw_pcie_write_dbi+0xa4>
  ff604007e0:	fd043703          	ld	a4,-48(s0)
  ff604007e4:	4785                	li	a5,1
  ff604007e6:	00f70863          	beq	a4,a5,ff604007f6 <dw_pcie_write_dbi+0x4c>
  ff604007ea:	fd043703          	ld	a4,-48(s0)
  ff604007ee:	4789                	li	a5,2
  ff604007f0:	02f70263          	beq	a4,a5,ff60400814 <dw_pcie_write_dbi+0x6a>
        dw_pcie_writew_dbi(pci, type, addr, (uint16_t)val);
        break;
    case 4:
        dw_pcie_writel_dbi(pci, type, addr, val);
    }
}
  ff604007f4:	a8a9                	j	ff6040084e <dw_pcie_write_dbi+0xa4>
        dw_pcie_writeb_dbi(pci, type, addr, (uint8_t)val);
  ff604007f6:	fdc42783          	lw	a5,-36(s0)
  ff604007fa:	0ff7f693          	andi	a3,a5,255
  ff604007fe:	fe042703          	lw	a4,-32(s0)
  ff60400802:	fe442783          	lw	a5,-28(s0)
  ff60400806:	863a                	mv	a2,a4
  ff60400808:	85be                	mv	a1,a5
  ff6040080a:	fe843503          	ld	a0,-24(s0)
  ff6040080e:	e0bff0ef          	jal	ra,ff60400618 <dw_pcie_writeb_dbi>
        break;
  ff60400812:	a835                	j	ff6040084e <dw_pcie_write_dbi+0xa4>
        dw_pcie_writew_dbi(pci, type, addr, (uint16_t)val);
  ff60400814:	fdc42783          	lw	a5,-36(s0)
  ff60400818:	03079693          	slli	a3,a5,0x30
  ff6040081c:	92c1                	srli	a3,a3,0x30
  ff6040081e:	fe042703          	lw	a4,-32(s0)
  ff60400822:	fe442783          	lw	a5,-28(s0)
  ff60400826:	863a                	mv	a2,a4
  ff60400828:	85be                	mv	a1,a5
  ff6040082a:	fe843503          	ld	a0,-24(s0)
  ff6040082e:	ec1ff0ef          	jal	ra,ff604006ee <dw_pcie_writew_dbi>
        break;
  ff60400832:	a831                	j	ff6040084e <dw_pcie_write_dbi+0xa4>
        dw_pcie_writel_dbi(pci, type, addr, val);
  ff60400834:	fdc42683          	lw	a3,-36(s0)
  ff60400838:	fe042703          	lw	a4,-32(s0)
  ff6040083c:	fe442783          	lw	a5,-28(s0)
  ff60400840:	863a                	mv	a2,a4
  ff60400842:	85be                	mv	a1,a5
  ff60400844:	fe843503          	ld	a0,-24(s0)
  ff60400848:	d8fff0ef          	jal	ra,ff604005d6 <dw_pcie_writel_dbi>
}
  ff6040084c:	a009                	j	ff6040084e <dw_pcie_write_dbi+0xa4>
  ff6040084e:	0001                	nop
  ff60400850:	70a2                	ld	ra,40(sp)
  ff60400852:	7402                	ld	s0,32(sp)
  ff60400854:	6145                	addi	sp,sp,48
  ff60400856:	8082                	ret

000000ff60400858 <dw_pcie_read_atu>:

uint32_t dw_pcie_read_atu(struct dw_pcie *pci, enum dw_pcie_region_type region, uint32_t index, uint32_t reg, size_t size)
{
  ff60400858:	7139                	addi	sp,sp,-64
  ff6040085a:	fc06                	sd	ra,56(sp)
  ff6040085c:	f822                	sd	s0,48(sp)
  ff6040085e:	0080                	addi	s0,sp,64
  ff60400860:	fca43c23          	sd	a0,-40(s0)
  ff60400864:	87ae                	mv	a5,a1
  ff60400866:	fce43023          	sd	a4,-64(s0)
  ff6040086a:	fcf42a23          	sw	a5,-44(s0)
  ff6040086e:	87b2                	mv	a5,a2
  ff60400870:	fcf42823          	sw	a5,-48(s0)
  ff60400874:	87b6                	mv	a5,a3
  ff60400876:	fcf42623          	sw	a5,-52(s0)
	uint32_t addr, dir;
    enum dw_pcie_access_type acc_type = DW_PCIE_ATU;
  ff6040087a:	478d                	li	a5,3
  ff6040087c:	fef42423          	sw	a5,-24(s0)

    switch (region) {
  ff60400880:	fd442783          	lw	a5,-44(s0)
  ff60400884:	0007871b          	sext.w	a4,a5
  ff60400888:	4785                	li	a5,1
  ff6040088a:	00f70a63          	beq	a4,a5,ff6040089e <dw_pcie_read_atu+0x46>
  ff6040088e:	fd442783          	lw	a5,-44(s0)
  ff60400892:	0007871b          	sext.w	a4,a5
  ff60400896:	4789                	li	a5,2
  ff60400898:	00f70763          	beq	a4,a5,ff604008a6 <dw_pcie_read_atu+0x4e>
  ff6040089c:	a801                	j	ff604008ac <dw_pcie_read_atu+0x54>
    case DW_PCIE_REGION_INBOUND:
        dir = 1;
  ff6040089e:	4785                	li	a5,1
  ff604008a0:	fef42623          	sw	a5,-20(s0)
        break;
  ff604008a4:	a821                	j	ff604008bc <dw_pcie_read_atu+0x64>
    case DW_PCIE_REGION_OUTBOUND:
        dir = 0;
  ff604008a6:	fe042623          	sw	zero,-20(s0)
        break;
  ff604008aa:	a809                	j	ff604008bc <dw_pcie_read_atu+0x64>
    default:
        dev_err(pci->dev, "Wrong Inbound/Outbound input\n");
  ff604008ac:	00001517          	auipc	a0,0x1
  ff604008b0:	7cc50513          	addi	a0,a0,1996 # ff60402078 <etext+0x78>
  ff604008b4:	f8eff0ef          	jal	ra,ff60400042 <printf>
        return -1;
  ff604008b8:	57fd                	li	a5,-1
  ff604008ba:	a091                	j	ff604008fe <dw_pcie_read_atu+0xa6>
    }

    addr = ((index << 9) | (dir << 8) | reg);
  ff604008bc:	fd042783          	lw	a5,-48(s0)
  ff604008c0:	0097979b          	slliw	a5,a5,0x9
  ff604008c4:	0007871b          	sext.w	a4,a5
  ff604008c8:	fec42783          	lw	a5,-20(s0)
  ff604008cc:	0087979b          	slliw	a5,a5,0x8
  ff604008d0:	2781                	sext.w	a5,a5
  ff604008d2:	8fd9                	or	a5,a5,a4
  ff604008d4:	0007871b          	sext.w	a4,a5
  ff604008d8:	fcc42783          	lw	a5,-52(s0)
  ff604008dc:	8fd9                	or	a5,a5,a4
  ff604008de:	fef42223          	sw	a5,-28(s0)
    return dw_pcie_read_dbi(pci, acc_type, addr, size);
  ff604008e2:	fe442703          	lw	a4,-28(s0)
  ff604008e6:	fe842783          	lw	a5,-24(s0)
  ff604008ea:	fc043683          	ld	a3,-64(s0)
  ff604008ee:	863a                	mv	a2,a4
  ff604008f0:	85be                	mv	a1,a5
  ff604008f2:	fd843503          	ld	a0,-40(s0)
  ff604008f6:	bcdff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff604008fa:	87aa                	mv	a5,a0
  ff604008fc:	2781                	sext.w	a5,a5
}
  ff604008fe:	853e                	mv	a0,a5
  ff60400900:	70e2                	ld	ra,56(sp)
  ff60400902:	7442                	ld	s0,48(sp)
  ff60400904:	6121                	addi	sp,sp,64
  ff60400906:	8082                	ret

000000ff60400908 <dw_pcie_write_atu>:

void dw_pcie_write_atu(struct dw_pcie *pci, enum dw_pcie_region_type region,
               uint32_t index, uint32_t reg, size_t size,  uint32_t val)
{
  ff60400908:	7139                	addi	sp,sp,-64
  ff6040090a:	fc06                	sd	ra,56(sp)
  ff6040090c:	f822                	sd	s0,48(sp)
  ff6040090e:	0080                	addi	s0,sp,64
  ff60400910:	fca43c23          	sd	a0,-40(s0)
  ff60400914:	fce43023          	sd	a4,-64(s0)
  ff60400918:	873e                	mv	a4,a5
  ff6040091a:	87ae                	mv	a5,a1
  ff6040091c:	fcf42a23          	sw	a5,-44(s0)
  ff60400920:	87b2                	mv	a5,a2
  ff60400922:	fcf42823          	sw	a5,-48(s0)
  ff60400926:	87b6                	mv	a5,a3
  ff60400928:	fcf42623          	sw	a5,-52(s0)
  ff6040092c:	87ba                	mv	a5,a4
  ff6040092e:	fcf42423          	sw	a5,-56(s0)
    uint32_t addr, dir;
    enum dw_pcie_access_type acc_type = DW_PCIE_ATU;
  ff60400932:	478d                	li	a5,3
  ff60400934:	fef42423          	sw	a5,-24(s0)
    
    switch (region) {
  ff60400938:	fd442783          	lw	a5,-44(s0)
  ff6040093c:	0007871b          	sext.w	a4,a5
  ff60400940:	4785                	li	a5,1
  ff60400942:	00f70a63          	beq	a4,a5,ff60400956 <dw_pcie_write_atu+0x4e>
  ff60400946:	fd442783          	lw	a5,-44(s0)
  ff6040094a:	0007871b          	sext.w	a4,a5
  ff6040094e:	4789                	li	a5,2
  ff60400950:	00f70763          	beq	a4,a5,ff6040095e <dw_pcie_write_atu+0x56>
  ff60400954:	a801                	j	ff60400964 <dw_pcie_write_atu+0x5c>
    case DW_PCIE_REGION_INBOUND:
        dir = 1;
  ff60400956:	4785                	li	a5,1
  ff60400958:	fef42623          	sw	a5,-20(s0)
        break;
  ff6040095c:	a819                	j	ff60400972 <dw_pcie_write_atu+0x6a>
    case DW_PCIE_REGION_OUTBOUND:
        dir = 0;
  ff6040095e:	fe042623          	sw	zero,-20(s0)
        break;
  ff60400962:	a801                	j	ff60400972 <dw_pcie_write_atu+0x6a>
    default:
        dev_err(pci->dev, "Wrong Inbound/Outbound input\n");
  ff60400964:	00001517          	auipc	a0,0x1
  ff60400968:	71450513          	addi	a0,a0,1812 # ff60402078 <etext+0x78>
  ff6040096c:	ed6ff0ef          	jal	ra,ff60400042 <printf>
        return;
  ff60400970:	a089                	j	ff604009b2 <dw_pcie_write_atu+0xaa>
    }

    addr = ((index << 9) | (dir << 8) | reg);
  ff60400972:	fd042783          	lw	a5,-48(s0)
  ff60400976:	0097979b          	slliw	a5,a5,0x9
  ff6040097a:	0007871b          	sext.w	a4,a5
  ff6040097e:	fec42783          	lw	a5,-20(s0)
  ff60400982:	0087979b          	slliw	a5,a5,0x8
  ff60400986:	2781                	sext.w	a5,a5
  ff60400988:	8fd9                	or	a5,a5,a4
  ff6040098a:	0007871b          	sext.w	a4,a5
  ff6040098e:	fcc42783          	lw	a5,-52(s0)
  ff60400992:	8fd9                	or	a5,a5,a4
  ff60400994:	fef42223          	sw	a5,-28(s0)
    dw_pcie_write_dbi(pci, acc_type, addr, val, size);
  ff60400998:	fc842683          	lw	a3,-56(s0)
  ff6040099c:	fe442603          	lw	a2,-28(s0)
  ff604009a0:	fe842783          	lw	a5,-24(s0)
  ff604009a4:	fc043703          	ld	a4,-64(s0)
  ff604009a8:	85be                	mv	a1,a5
  ff604009aa:	fd843503          	ld	a0,-40(s0)
  ff604009ae:	dfdff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
}
  ff604009b2:	70e2                	ld	ra,56(sp)
  ff604009b4:	7442                	ld	s0,48(sp)
  ff604009b6:	6121                	addi	sp,sp,64
  ff604009b8:	8082                	ret

000000ff604009ba <dw_pcie_prog_outbound_atu>:
}
*/

void dw_pcie_prog_outbound_atu(struct dw_pcie *pci, int index, int type,
			       uint64_t cpu_addr, uint64_t pci_addr, uint64_t size)
{
  ff604009ba:	7139                	addi	sp,sp,-64
  ff604009bc:	fc06                	sd	ra,56(sp)
  ff604009be:	f822                	sd	s0,48(sp)
  ff604009c0:	0080                	addi	s0,sp,64
  ff604009c2:	fea43423          	sd	a0,-24(s0)
  ff604009c6:	fcd43c23          	sd	a3,-40(s0)
  ff604009ca:	fce43823          	sd	a4,-48(s0)
  ff604009ce:	fcf43423          	sd	a5,-56(s0)
  ff604009d2:	87ae                	mv	a5,a1
  ff604009d4:	fef42223          	sw	a5,-28(s0)
  ff604009d8:	87b2                	mv	a5,a2
  ff604009da:	fef42023          	sw	a5,-32(s0)
	//uint32_t retries, val;

	dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff604009de:	fe442603          	lw	a2,-28(s0)
  ff604009e2:	fd843783          	ld	a5,-40(s0)
  ff604009e6:	2781                	sext.w	a5,a5
  ff604009e8:	4711                	li	a4,4
  ff604009ea:	46a1                	li	a3,8
  ff604009ec:	4589                	li	a1,2
  ff604009ee:	fe843503          	ld	a0,-24(s0)
  ff604009f2:	f17ff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
                PCIE_IATU_LWR_BASE_ADDR_OFF_OUTBOUND, 0x4, lower_32_bits(cpu_addr));
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff604009f6:	fe442603          	lw	a2,-28(s0)
                PCIE_IATU_UPPER_BASE_ADDR_OFF_OUTBOUND, 0x4, upper_32_bits(cpu_addr));
  ff604009fa:	fd843783          	ld	a5,-40(s0)
  ff604009fe:	9381                	srli	a5,a5,0x20
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a00:	2781                	sext.w	a5,a5
  ff60400a02:	4711                	li	a4,4
  ff60400a04:	46b1                	li	a3,12
  ff60400a06:	4589                	li	a1,2
  ff60400a08:	fe843503          	ld	a0,-24(s0)
  ff60400a0c:	efdff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a10:	fe442603          	lw	a2,-28(s0)
                PCIE_IATU_LWR_LIMIT_ADDR_OFF_OUTBOUND, 0x4, lower_32_bits(cpu_addr + size -1));
  ff60400a14:	fd843783          	ld	a5,-40(s0)
  ff60400a18:	0007871b          	sext.w	a4,a5
  ff60400a1c:	fc843783          	ld	a5,-56(s0)
  ff60400a20:	2781                	sext.w	a5,a5
  ff60400a22:	9fb9                	addw	a5,a5,a4
  ff60400a24:	2781                	sext.w	a5,a5
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a26:	37fd                	addiw	a5,a5,-1
  ff60400a28:	2781                	sext.w	a5,a5
  ff60400a2a:	4711                	li	a4,4
  ff60400a2c:	46c1                	li	a3,16
  ff60400a2e:	4589                	li	a1,2
  ff60400a30:	fe843503          	ld	a0,-24(s0)
  ff60400a34:	ed5ff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a38:	fe442603          	lw	a2,-28(s0)
                PCIE_IATU_UPPER_LIMIT_ADDR_OFF_OUTBOUND, 0x4, upper_32_bits(cpu_addr + size -1));
  ff60400a3c:	fd843703          	ld	a4,-40(s0)
  ff60400a40:	fc843783          	ld	a5,-56(s0)
  ff60400a44:	97ba                	add	a5,a5,a4
  ff60400a46:	17fd                	addi	a5,a5,-1
  ff60400a48:	9381                	srli	a5,a5,0x20
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a4a:	2781                	sext.w	a5,a5
  ff60400a4c:	4711                	li	a4,4
  ff60400a4e:	02000693          	li	a3,32
  ff60400a52:	4589                	li	a1,2
  ff60400a54:	fe843503          	ld	a0,-24(s0)
  ff60400a58:	eb1ff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a5c:	fe442603          	lw	a2,-28(s0)
  ff60400a60:	fd043783          	ld	a5,-48(s0)
  ff60400a64:	2781                	sext.w	a5,a5
  ff60400a66:	4711                	li	a4,4
  ff60400a68:	46d1                	li	a3,20
  ff60400a6a:	4589                	li	a1,2
  ff60400a6c:	fe843503          	ld	a0,-24(s0)
  ff60400a70:	e99ff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
                PCIE_IATU_LWR_TARGET_ADDR_OFF_OUTBOUND, 0x4, lower_32_bits(pci_addr));
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a74:	fe442603          	lw	a2,-28(s0)
                PCIE_IATU_UPPER_TARGET_ADDR_OFF_OUTBOUND, 0x4, upper_32_bits(pci_addr));
  ff60400a78:	fd043783          	ld	a5,-48(s0)
  ff60400a7c:	9381                	srli	a5,a5,0x20
    dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a7e:	2781                	sext.w	a5,a5
  ff60400a80:	4711                	li	a4,4
  ff60400a82:	46e1                	li	a3,24
  ff60400a84:	4589                	li	a1,2
  ff60400a86:	fe843503          	ld	a0,-24(s0)
  ff60400a8a:	e7fff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
	dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400a8e:	fe442603          	lw	a2,-28(s0)
  ff60400a92:	fe042783          	lw	a5,-32(s0)
  ff60400a96:	4711                	li	a4,4
  ff60400a98:	4681                	li	a3,0
  ff60400a9a:	4589                	li	a1,2
  ff60400a9c:	fe843503          	ld	a0,-24(s0)
  ff60400aa0:	e69ff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>
                PCIE_IATU_REGION_CTRL1_OFF_OUTBOUND, 0x4, type);
	dw_pcie_write_atu(pci, DW_PCIE_REGION_OUTBOUND, index,
  ff60400aa4:	fe442603          	lw	a2,-28(s0)
  ff60400aa8:	800007b7          	lui	a5,0x80000
  ff60400aac:	4711                	li	a4,4
  ff60400aae:	4691                	li	a3,4
  ff60400ab0:	4589                	li	a1,2
  ff60400ab2:	fe843503          	ld	a0,-24(s0)
  ff60400ab6:	e53ff0ef          	jal	ra,ff60400908 <dw_pcie_write_atu>

		mdelay(LINK_WAIT_IATU);
	}
	dev_err(pci->dev, "Outbound iATU is not being enabled\n");
    */
}
  ff60400aba:	0001                	nop
  ff60400abc:	70e2                	ld	ra,56(sp)
  ff60400abe:	7442                	ld	s0,48(sp)
  ff60400ac0:	6121                	addi	sp,sp,64
  ff60400ac2:	8082                	ret

000000ff60400ac4 <dw_pcie_rd_own_conf>:
}
*/

static void dw_pcie_rd_own_conf(struct pcie_port *pp, int where, int size,
			       uint32_t *val)
{
  ff60400ac4:	7139                	addi	sp,sp,-64
  ff60400ac6:	fc06                	sd	ra,56(sp)
  ff60400ac8:	f822                	sd	s0,48(sp)
  ff60400aca:	0080                	addi	s0,sp,64
  ff60400acc:	fca43c23          	sd	a0,-40(s0)
  ff60400ad0:	87ae                	mv	a5,a1
  ff60400ad2:	8732                	mv	a4,a2
  ff60400ad4:	fcd43423          	sd	a3,-56(s0)
  ff60400ad8:	fcf42a23          	sw	a5,-44(s0)
  ff60400adc:	87ba                	mv	a5,a4
  ff60400ade:	fcf42823          	sw	a5,-48(s0)
	struct dw_pcie *pci;

	//if (pp->ops->rd_own_conf)
	//	return pp->ops->rd_own_conf(pp, where, size, val);

	pci = to_dw_pcie_from_pp(pp);
  ff60400ae2:	fd843783          	ld	a5,-40(s0)
  ff60400ae6:	fef43423          	sd	a5,-24(s0)
  ff60400aea:	fe843783          	ld	a5,-24(s0)
  ff60400aee:	fa878793          	addi	a5,a5,-88 # ffffffff7fffffa8 <ebss+0xffffff001fbfcb70>
  ff60400af2:	fef43023          	sd	a5,-32(s0)
	*val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, where, size);
  ff60400af6:	fd442783          	lw	a5,-44(s0)
  ff60400afa:	fd042703          	lw	a4,-48(s0)
  ff60400afe:	86ba                	mv	a3,a4
  ff60400b00:	863e                	mv	a2,a5
  ff60400b02:	4581                	li	a1,0
  ff60400b04:	fe043503          	ld	a0,-32(s0)
  ff60400b08:	9bbff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400b0c:	87aa                	mv	a5,a0
  ff60400b0e:	0007871b          	sext.w	a4,a5
  ff60400b12:	fc843783          	ld	a5,-56(s0)
  ff60400b16:	c398                	sw	a4,0(a5)
}
  ff60400b18:	0001                	nop
  ff60400b1a:	70e2                	ld	ra,56(sp)
  ff60400b1c:	7442                	ld	s0,48(sp)
  ff60400b1e:	6121                	addi	sp,sp,64
  ff60400b20:	8082                	ret

000000ff60400b22 <dw_pcie_wr_own_conf>:

static void dw_pcie_wr_own_conf(struct pcie_port *pp, int where, int size,
			       uint32_t val)
{
  ff60400b22:	7139                	addi	sp,sp,-64
  ff60400b24:	fc06                	sd	ra,56(sp)
  ff60400b26:	f822                	sd	s0,48(sp)
  ff60400b28:	0080                	addi	s0,sp,64
  ff60400b2a:	fca43c23          	sd	a0,-40(s0)
  ff60400b2e:	87ae                	mv	a5,a1
  ff60400b30:	8736                	mv	a4,a3
  ff60400b32:	fcf42a23          	sw	a5,-44(s0)
  ff60400b36:	87b2                	mv	a5,a2
  ff60400b38:	fcf42823          	sw	a5,-48(s0)
  ff60400b3c:	87ba                	mv	a5,a4
  ff60400b3e:	fcf42623          	sw	a5,-52(s0)
	struct dw_pcie *pci;

	//if (pp->ops->wr_own_conf)
	//	return pp->ops->wr_own_conf(pp, where, size, val);

	pci = to_dw_pcie_from_pp(pp);
  ff60400b42:	fd843783          	ld	a5,-40(s0)
  ff60400b46:	fef43423          	sd	a5,-24(s0)
  ff60400b4a:	fe843783          	ld	a5,-24(s0)
  ff60400b4e:	fa878793          	addi	a5,a5,-88
  ff60400b52:	fef43023          	sd	a5,-32(s0)
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, where, val, size);
  ff60400b56:	fd442783          	lw	a5,-44(s0)
  ff60400b5a:	fd042703          	lw	a4,-48(s0)
  ff60400b5e:	fcc42683          	lw	a3,-52(s0)
  ff60400b62:	863e                	mv	a2,a5
  ff60400b64:	4581                	li	a1,0
  ff60400b66:	fe043503          	ld	a0,-32(s0)
  ff60400b6a:	c41ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
}
  ff60400b6e:	0001                	nop
  ff60400b70:	70e2                	ld	ra,56(sp)
  ff60400b72:	7442                	ld	s0,48(sp)
  ff60400b74:	6121                	addi	sp,sp,64
  ff60400b76:	8082                	ret

000000ff60400b78 <dw_pcie_setup>:
	return dw_pcie_wait_for_link(pci);

}
*/
void dw_pcie_setup(struct dw_pcie *pci)
{
  ff60400b78:	7179                	addi	sp,sp,-48
  ff60400b7a:	f406                	sd	ra,40(sp)
  ff60400b7c:	f022                	sd	s0,32(sp)
  ff60400b7e:	1800                	addi	s0,sp,48
  ff60400b80:	fca43c23          	sd	a0,-40(s0)
	uint32_t val, tmp;
	uint32_t lanes = pci->lane_num;
  ff60400b84:	fd843783          	ld	a5,-40(s0)
  ff60400b88:	43bc                	lw	a5,64(a5)
  ff60400b8a:	fef42423          	sw	a5,-24(s0)
    uint8_t order = pci->order;
  ff60400b8e:	fd843783          	ld	a5,-40(s0)
  ff60400b92:	0457c783          	lbu	a5,69(a5)
  ff60400b96:	fef403a3          	sb	a5,-25(s0)

    /* Conifg Fast Link Scale Factor is 64(16us) */
    val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_TIMER_CTRL_MAX_FUN_NUM_OFF, 0x4);
  ff60400b9a:	4691                	li	a3,4
  ff60400b9c:	71800613          	li	a2,1816
  ff60400ba0:	4581                	li	a1,0
  ff60400ba2:	fd843503          	ld	a0,-40(s0)
  ff60400ba6:	91dff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400baa:	87aa                	mv	a5,a0
  ff60400bac:	fef42623          	sw	a5,-20(s0)
    tmp = 0x2 << 29;
  ff60400bb0:	400007b7          	lui	a5,0x40000
  ff60400bb4:	fef42023          	sw	a5,-32(s0)
    val |= tmp;
  ff60400bb8:	fec42703          	lw	a4,-20(s0)
  ff60400bbc:	fe042783          	lw	a5,-32(s0)
  ff60400bc0:	8fd9                	or	a5,a5,a4
  ff60400bc2:	fef42623          	sw	a5,-20(s0)
    dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_TIMER_CTRL_MAX_FUN_NUM_OFF, val, 0x4);
  ff60400bc6:	fec42783          	lw	a5,-20(s0)
  ff60400bca:	4711                	li	a4,4
  ff60400bcc:	86be                	mv	a3,a5
  ff60400bce:	71800613          	li	a2,1816
  ff60400bd2:	4581                	li	a1,0
  ff60400bd4:	fd843503          	ld	a0,-40(s0)
  ff60400bd8:	bd3ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

	/* Set the number of lanes */
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_PORT_LINK_CONTROL, 0x4);
  ff60400bdc:	4691                	li	a3,4
  ff60400bde:	71000613          	li	a2,1808
  ff60400be2:	4581                	li	a1,0
  ff60400be4:	fd843503          	ld	a0,-40(s0)
  ff60400be8:	8dbff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400bec:	87aa                	mv	a5,a0
  ff60400bee:	fef42623          	sw	a5,-20(s0)
	val &= ~PORT_LINK_MODE_MASK;
  ff60400bf2:	fec42703          	lw	a4,-20(s0)
  ff60400bf6:	ffc107b7          	lui	a5,0xffc10
  ff60400bfa:	17fd                	addi	a5,a5,-1
  ff60400bfc:	8ff9                	and	a5,a5,a4
  ff60400bfe:	fef42623          	sw	a5,-20(s0)
	switch (lanes) {
  ff60400c02:	fe842783          	lw	a5,-24(s0)
  ff60400c06:	0007871b          	sext.w	a4,a5
  ff60400c0a:	47c1                	li	a5,16
  ff60400c0c:	04f70863          	beq	a4,a5,ff60400c5c <dw_pcie_setup+0xe4>
  ff60400c10:	fe842783          	lw	a5,-24(s0)
  ff60400c14:	0007871b          	sext.w	a4,a5
  ff60400c18:	47c1                	li	a5,16
  ff60400c1a:	04e7e963          	bltu	a5,a4,ff60400c6c <dw_pcie_setup+0xf4>
  ff60400c1e:	fe842783          	lw	a5,-24(s0)
  ff60400c22:	0007871b          	sext.w	a4,a5
  ff60400c26:	4791                	li	a5,4
  ff60400c28:	00f70a63          	beq	a4,a5,ff60400c3c <dw_pcie_setup+0xc4>
  ff60400c2c:	fe842783          	lw	a5,-24(s0)
  ff60400c30:	0007871b          	sext.w	a4,a5
  ff60400c34:	47a1                	li	a5,8
  ff60400c36:	00f70b63          	beq	a4,a5,ff60400c4c <dw_pcie_setup+0xd4>
  ff60400c3a:	a80d                	j	ff60400c6c <dw_pcie_setup+0xf4>
	case 4:
		val |= PORT_LINK_MODE_4_LANES;
  ff60400c3c:	fec42703          	lw	a4,-20(s0)
  ff60400c40:	000707b7          	lui	a5,0x70
  ff60400c44:	8fd9                	or	a5,a5,a4
  ff60400c46:	fef42623          	sw	a5,-20(s0)
		break;
  ff60400c4a:	a00d                	j	ff60400c6c <dw_pcie_setup+0xf4>
	case 8:
		val |= PORT_LINK_MODE_8_LANES;
  ff60400c4c:	fec42703          	lw	a4,-20(s0)
  ff60400c50:	000f07b7          	lui	a5,0xf0
  ff60400c54:	8fd9                	or	a5,a5,a4
  ff60400c56:	fef42623          	sw	a5,-20(s0)
		break;
  ff60400c5a:	a809                	j	ff60400c6c <dw_pcie_setup+0xf4>
	case 16:
		val |= PORT_LINK_MODE_16_LANES;
  ff60400c5c:	fec42703          	lw	a4,-20(s0)
  ff60400c60:	001f07b7          	lui	a5,0x1f0
  ff60400c64:	8fd9                	or	a5,a5,a4
  ff60400c66:	fef42623          	sw	a5,-20(s0)
		break;
  ff60400c6a:	0001                	nop
        // TODO: 
		//dev_err(pci->dev, "num-lanes %u: invalid value\n", lanes);
		//return;
	}

    val |= BIT(7); // set fast link mode
  ff60400c6c:	fec42783          	lw	a5,-20(s0)
  ff60400c70:	0807e793          	ori	a5,a5,128
  ff60400c74:	fef42623          	sw	a5,-20(s0)
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_PORT_LINK_CONTROL, val, 0x4);
  ff60400c78:	fec42783          	lw	a5,-20(s0)
  ff60400c7c:	4711                	li	a4,4
  ff60400c7e:	86be                	mv	a3,a5
  ff60400c80:	71000613          	li	a2,1808
  ff60400c84:	4581                	li	a1,0
  ff60400c86:	fd843503          	ld	a0,-40(s0)
  ff60400c8a:	b21ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

	/* Set link width speed control register */
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_LINK_WIDTH_SPEED_CONTROL, 0x4);
  ff60400c8e:	4691                	li	a3,4
  ff60400c90:	6785                	lui	a5,0x1
  ff60400c92:	80c78613          	addi	a2,a5,-2036 # 80c <__raw_writel-0xff603ff7f4>
  ff60400c96:	4581                	li	a1,0
  ff60400c98:	fd843503          	ld	a0,-40(s0)
  ff60400c9c:	827ff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400ca0:	87aa                	mv	a5,a0
  ff60400ca2:	fef42623          	sw	a5,-20(s0)
	val &= ~PORT_LOGIC_LINK_WIDTH_MASK;
  ff60400ca6:	fec42703          	lw	a4,-20(s0)
  ff60400caa:	77f9                	lui	a5,0xffffe
  ff60400cac:	0ff78793          	addi	a5,a5,255 # ffffffffffffe0ff <ebss+0xffffff009fbfacc7>
  ff60400cb0:	8ff9                	and	a5,a5,a4
  ff60400cb2:	fef42623          	sw	a5,-20(s0)
	switch (lanes) {
  ff60400cb6:	fe842783          	lw	a5,-24(s0)
  ff60400cba:	0007871b          	sext.w	a4,a5
  ff60400cbe:	47c1                	li	a5,16
  ff60400cc0:	04f70863          	beq	a4,a5,ff60400d10 <dw_pcie_setup+0x198>
  ff60400cc4:	fe842783          	lw	a5,-24(s0)
  ff60400cc8:	0007871b          	sext.w	a4,a5
  ff60400ccc:	47c1                	li	a5,16
  ff60400cce:	04e7e863          	bltu	a5,a4,ff60400d1e <dw_pcie_setup+0x1a6>
  ff60400cd2:	fe842783          	lw	a5,-24(s0)
  ff60400cd6:	0007871b          	sext.w	a4,a5
  ff60400cda:	4791                	li	a5,4
  ff60400cdc:	00f70a63          	beq	a4,a5,ff60400cf0 <dw_pcie_setup+0x178>
  ff60400ce0:	fe842783          	lw	a5,-24(s0)
  ff60400ce4:	0007871b          	sext.w	a4,a5
  ff60400ce8:	47a1                	li	a5,8
  ff60400cea:	00f70a63          	beq	a4,a5,ff60400cfe <dw_pcie_setup+0x186>
  ff60400cee:	a805                	j	ff60400d1e <dw_pcie_setup+0x1a6>
	case 4:
		val |= PORT_LOGIC_LINK_WIDTH_4_LANES;
  ff60400cf0:	fec42783          	lw	a5,-20(s0)
  ff60400cf4:	4007e793          	ori	a5,a5,1024
  ff60400cf8:	fef42623          	sw	a5,-20(s0)
		break;
  ff60400cfc:	a00d                	j	ff60400d1e <dw_pcie_setup+0x1a6>
	case 8:
		val |= PORT_LOGIC_LINK_WIDTH_8_LANES;
  ff60400cfe:	fec42703          	lw	a4,-20(s0)
  ff60400d02:	6785                	lui	a5,0x1
  ff60400d04:	80078793          	addi	a5,a5,-2048 # 800 <__raw_writel-0xff603ff800>
  ff60400d08:	8fd9                	or	a5,a5,a4
  ff60400d0a:	fef42623          	sw	a5,-20(s0)
		break;
  ff60400d0e:	a801                	j	ff60400d1e <dw_pcie_setup+0x1a6>
	case 16:
		val |= PORT_LOGIC_LINK_WIDTH_16_LANES;
  ff60400d10:	fec42703          	lw	a4,-20(s0)
  ff60400d14:	6785                	lui	a5,0x1
  ff60400d16:	8fd9                	or	a5,a5,a4
  ff60400d18:	fef42623          	sw	a5,-20(s0)
		break;
  ff60400d1c:	0001                	nop
	}
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_LINK_WIDTH_SPEED_CONTROL, val, 0x4);
  ff60400d1e:	fec42783          	lw	a5,-20(s0)
  ff60400d22:	4711                	li	a4,4
  ff60400d24:	86be                	mv	a3,a5
  ff60400d26:	6785                	lui	a5,0x1
  ff60400d28:	80c78613          	addi	a2,a5,-2036 # 80c <__raw_writel-0xff603ff7f4>
  ff60400d2c:	4581                	li	a1,0
  ff60400d2e:	fd843503          	ld	a0,-40(s0)
  ff60400d32:	a79ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_PORT_FORCE_OFF, 0x4);
  ff60400d36:	4691                	li	a3,4
  ff60400d38:	70800613          	li	a2,1800
  ff60400d3c:	4581                	li	a1,0
  ff60400d3e:	fd843503          	ld	a0,-40(s0)
  ff60400d42:	f80ff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400d46:	87aa                	mv	a5,a0
  ff60400d48:	fef42623          	sw	a5,-20(s0)
    val &= ~PORT_LINK_NUM_MASK;
  ff60400d4c:	fec42783          	lw	a5,-20(s0)
  ff60400d50:	f007f793          	andi	a5,a5,-256
  ff60400d54:	fef42623          	sw	a5,-20(s0)
    val |= PORT_LINK_NUM(order);
  ff60400d58:	fe744783          	lbu	a5,-25(s0)
  ff60400d5c:	0007871b          	sext.w	a4,a5
  ff60400d60:	fec42783          	lw	a5,-20(s0)
  ff60400d64:	8fd9                	or	a5,a5,a4
  ff60400d66:	fef42623          	sw	a5,-20(s0)
    dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_PORT_FORCE_OFF, val, 0x4);
  ff60400d6a:	fec42783          	lw	a5,-20(s0)
  ff60400d6e:	4711                	li	a4,4
  ff60400d70:	86be                	mv	a3,a5
  ff60400d72:	70800613          	li	a2,1800
  ff60400d76:	4581                	li	a1,0
  ff60400d78:	fd843503          	ld	a0,-40(s0)
  ff60400d7c:	a2fff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

    val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_GEN3_RELATED_OFF, 0x4);
  ff60400d80:	4691                	li	a3,4
  ff60400d82:	6785                	lui	a5,0x1
  ff60400d84:	89078613          	addi	a2,a5,-1904 # 890 <__raw_writel-0xff603ff770>
  ff60400d88:	4581                	li	a1,0
  ff60400d8a:	fd843503          	ld	a0,-40(s0)
  ff60400d8e:	f34ff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400d92:	87aa                	mv	a5,a0
  ff60400d94:	fef42623          	sw	a5,-20(s0)
    val |= 0x200;
  ff60400d98:	fec42783          	lw	a5,-20(s0)
  ff60400d9c:	2007e793          	ori	a5,a5,512
  ff60400da0:	fef42623          	sw	a5,-20(s0)
    val &= ~RATE_SHADOW_SEL_MASK;
  ff60400da4:	fec42703          	lw	a4,-20(s0)
  ff60400da8:	fd0007b7          	lui	a5,0xfd000
  ff60400dac:	17fd                	addi	a5,a5,-1
  ff60400dae:	8ff9                	and	a5,a5,a4
  ff60400db0:	fef42623          	sw	a5,-20(s0)
    val |= RATE_SHADOW_SEL(0x0);
    dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_GEN3_RELATED_OFF, val, 0x4);
  ff60400db4:	fec42783          	lw	a5,-20(s0)
  ff60400db8:	4711                	li	a4,4
  ff60400dba:	86be                	mv	a3,a5
  ff60400dbc:	6785                	lui	a5,0x1
  ff60400dbe:	89078613          	addi	a2,a5,-1904 # 890 <__raw_writel-0xff603ff770>
  ff60400dc2:	4581                	li	a1,0
  ff60400dc4:	fd843503          	ld	a0,-40(s0)
  ff60400dc8:	9e3ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

    val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_GEN3_RELATED_OFF, 0x4);
  ff60400dcc:	4691                	li	a3,4
  ff60400dce:	6785                	lui	a5,0x1
  ff60400dd0:	89078613          	addi	a2,a5,-1904 # 890 <__raw_writel-0xff603ff770>
  ff60400dd4:	4581                	li	a1,0
  ff60400dd6:	fd843503          	ld	a0,-40(s0)
  ff60400dda:	ee8ff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400dde:	87aa                	mv	a5,a0
  ff60400de0:	fef42623          	sw	a5,-20(s0)
    val &= ~RATE_SHADOW_SEL_MASK;
  ff60400de4:	fec42703          	lw	a4,-20(s0)
  ff60400de8:	fd0007b7          	lui	a5,0xfd000
  ff60400dec:	17fd                	addi	a5,a5,-1
  ff60400dee:	8ff9                	and	a5,a5,a4
  ff60400df0:	fef42623          	sw	a5,-20(s0)
    val |= RATE_SHADOW_SEL(0x1);
  ff60400df4:	fec42703          	lw	a4,-20(s0)
  ff60400df8:	010007b7          	lui	a5,0x1000
  ff60400dfc:	8fd9                	or	a5,a5,a4
  ff60400dfe:	fef42623          	sw	a5,-20(s0)
    dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_GEN3_RELATED_OFF, val, 0x4);
  ff60400e02:	fec42783          	lw	a5,-20(s0)
  ff60400e06:	4711                	li	a4,4
  ff60400e08:	86be                	mv	a3,a5
  ff60400e0a:	6785                	lui	a5,0x1
  ff60400e0c:	89078613          	addi	a2,a5,-1904 # 890 <__raw_writel-0xff603ff770>
  ff60400e10:	4581                	li	a1,0
  ff60400e12:	fd843503          	ld	a0,-40(s0)
  ff60400e16:	995ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

    val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCIE_GEN3_RELATED_OFF, 0x4);
  ff60400e1a:	4691                	li	a3,4
  ff60400e1c:	6785                	lui	a5,0x1
  ff60400e1e:	89078613          	addi	a2,a5,-1904 # 890 <__raw_writel-0xff603ff770>
  ff60400e22:	4581                	li	a1,0
  ff60400e24:	fd843503          	ld	a0,-40(s0)
  ff60400e28:	e9aff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400e2c:	87aa                	mv	a5,a0
  ff60400e2e:	fef42623          	sw	a5,-20(s0)
    val |= 0x200;
  ff60400e32:	fec42783          	lw	a5,-20(s0)
  ff60400e36:	2007e793          	ori	a5,a5,512
  ff60400e3a:	fef42623          	sw	a5,-20(s0)
    val &= ~RATE_SHADOW_SEL_MASK;
  ff60400e3e:	fec42703          	lw	a4,-20(s0)
  ff60400e42:	fd0007b7          	lui	a5,0xfd000
  ff60400e46:	17fd                	addi	a5,a5,-1
  ff60400e48:	8ff9                	and	a5,a5,a4
  ff60400e4a:	fef42623          	sw	a5,-20(s0)
    val |= RATE_SHADOW_SEL(0x1);
  ff60400e4e:	fec42703          	lw	a4,-20(s0)
  ff60400e52:	010007b7          	lui	a5,0x1000
  ff60400e56:	8fd9                	or	a5,a5,a4
  ff60400e58:	fef42623          	sw	a5,-20(s0)
    dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCIE_GEN3_RELATED_OFF, val, 0x4);
  ff60400e5c:	fec42783          	lw	a5,-20(s0)
  ff60400e60:	4711                	li	a4,4
  ff60400e62:	86be                	mv	a3,a5
  ff60400e64:	6785                	lui	a5,0x1
  ff60400e66:	89078613          	addi	a2,a5,-1904 # 890 <__raw_writel-0xff603ff770>
  ff60400e6a:	4581                	li	a1,0
  ff60400e6c:	fd843503          	ld	a0,-40(s0)
  ff60400e70:	93bff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
		val |= PCIE_PL_CHK_REG_CHK_REG_CONTINUOUS |
		       PCIE_PL_CHK_REG_CHK_REG_START;
		dw_pcie_writel_dbi(pci, PCIE_PL_CHK_REG_CONTROL_STATUS, val);
	}
*/
}
  ff60400e74:	0001                	nop
  ff60400e76:	70a2                	ld	ra,40(sp)
  ff60400e78:	7402                	ld	s0,32(sp)
  ff60400e7a:	6145                	addi	sp,sp,48
  ff60400e7c:	8082                	ret

000000ff60400e7e <dw_pcie_setup_rc>:


void dw_pcie_setup_rc(struct pcie_port *pp)
{
  ff60400e7e:	7139                	addi	sp,sp,-64
  ff60400e80:	fc06                	sd	ra,56(sp)
  ff60400e82:	f822                	sd	s0,48(sp)
  ff60400e84:	0080                	addi	s0,sp,64
  ff60400e86:	fca43423          	sd	a0,-56(s0)
	uint32_t val;
	struct dw_pcie *pci = to_dw_pcie_from_pp(pp);
  ff60400e8a:	fc843783          	ld	a5,-56(s0)
  ff60400e8e:	fef43423          	sd	a5,-24(s0)
  ff60400e92:	fe843783          	ld	a5,-24(s0)
  ff60400e96:	fa878793          	addi	a5,a5,-88
  ff60400e9a:	fef43023          	sd	a5,-32(s0)

    dw_pcie_dbi_ro_wr_en(pci);
  ff60400e9e:	fe043503          	ld	a0,-32(s0)
  ff60400ea2:	ae0ff0ef          	jal	ra,ff60400182 <dw_pcie_dbi_ro_wr_en>

    dw_pcie_setup(pci);
  ff60400ea6:	fe043503          	ld	a0,-32(s0)
  ff60400eaa:	ccfff0ef          	jal	ra,ff60400b78 <dw_pcie_setup>

	/* Setup RC BARs */
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCI_BASE_ADDRESS_0, 0x00000004, 0x4);
  ff60400eae:	4711                	li	a4,4
  ff60400eb0:	4691                	li	a3,4
  ff60400eb2:	4641                	li	a2,16
  ff60400eb4:	4581                	li	a1,0
  ff60400eb6:	fe043503          	ld	a0,-32(s0)
  ff60400eba:	8f1ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCI_BASE_ADDRESS_1, 0x00000000, 0x4);
  ff60400ebe:	4711                	li	a4,4
  ff60400ec0:	4681                	li	a3,0
  ff60400ec2:	4651                	li	a2,20
  ff60400ec4:	4581                	li	a1,0
  ff60400ec6:	fe043503          	ld	a0,-32(s0)
  ff60400eca:	8e1ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

	/* Setup interrupt pins */
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCI_INTERRUPT_LINE, 0x4);
  ff60400ece:	4691                	li	a3,4
  ff60400ed0:	03c00613          	li	a2,60
  ff60400ed4:	4581                	li	a1,0
  ff60400ed6:	fe043503          	ld	a0,-32(s0)
  ff60400eda:	de8ff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400ede:	87aa                	mv	a5,a0
  ff60400ee0:	2781                	sext.w	a5,a5
  ff60400ee2:	fcf42e23          	sw	a5,-36(s0)
	val &= 0xffff00ff;
  ff60400ee6:	fdc42783          	lw	a5,-36(s0)
  ff60400eea:	873e                	mv	a4,a5
  ff60400eec:	77c1                	lui	a5,0xffff0
  ff60400eee:	0ff78793          	addi	a5,a5,255 # ffffffffffff00ff <ebss+0xffffff009fbeccc7>
  ff60400ef2:	8ff9                	and	a5,a5,a4
  ff60400ef4:	2781                	sext.w	a5,a5
  ff60400ef6:	fcf42e23          	sw	a5,-36(s0)
	val |= 0x00000100;
  ff60400efa:	fdc42783          	lw	a5,-36(s0)
  ff60400efe:	1007e793          	ori	a5,a5,256
  ff60400f02:	2781                	sext.w	a5,a5
  ff60400f04:	fcf42e23          	sw	a5,-36(s0)
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCI_INTERRUPT_LINE, val, 0x4);
  ff60400f08:	fdc42783          	lw	a5,-36(s0)
  ff60400f0c:	4711                	li	a4,4
  ff60400f0e:	86be                	mv	a3,a5
  ff60400f10:	03c00613          	li	a2,60
  ff60400f14:	4581                	li	a1,0
  ff60400f16:	fe043503          	ld	a0,-32(s0)
  ff60400f1a:	891ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

	/* Setup bus numbers */
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCI_PRIMARY_BUS, 0x4);
  ff60400f1e:	4691                	li	a3,4
  ff60400f20:	4661                	li	a2,24
  ff60400f22:	4581                	li	a1,0
  ff60400f24:	fe043503          	ld	a0,-32(s0)
  ff60400f28:	d9aff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400f2c:	87aa                	mv	a5,a0
  ff60400f2e:	2781                	sext.w	a5,a5
  ff60400f30:	fcf42e23          	sw	a5,-36(s0)
	val &= 0xff000000;
  ff60400f34:	fdc42783          	lw	a5,-36(s0)
  ff60400f38:	873e                	mv	a4,a5
  ff60400f3a:	ff0007b7          	lui	a5,0xff000
  ff60400f3e:	8ff9                	and	a5,a5,a4
  ff60400f40:	2781                	sext.w	a5,a5
  ff60400f42:	fcf42e23          	sw	a5,-36(s0)
	val |= 0x00ff0100;
  ff60400f46:	fdc42783          	lw	a5,-36(s0)
  ff60400f4a:	873e                	mv	a4,a5
  ff60400f4c:	00ff07b7          	lui	a5,0xff0
  ff60400f50:	10078793          	addi	a5,a5,256 # ff0100 <__raw_writel-0xff5f40ff00>
  ff60400f54:	8fd9                	or	a5,a5,a4
  ff60400f56:	2781                	sext.w	a5,a5
  ff60400f58:	fcf42e23          	sw	a5,-36(s0)
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCI_PRIMARY_BUS, val, 0x4);
  ff60400f5c:	fdc42783          	lw	a5,-36(s0)
  ff60400f60:	4711                	li	a4,4
  ff60400f62:	86be                	mv	a3,a5
  ff60400f64:	4661                	li	a2,24
  ff60400f66:	4581                	li	a1,0
  ff60400f68:	fe043503          	ld	a0,-32(s0)
  ff60400f6c:	83fff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>

	/* Setup command register */
	val = dw_pcie_read_dbi(pci, DW_PCIE_CDM, PCI_COMMAND, 0x4);
  ff60400f70:	4691                	li	a3,4
  ff60400f72:	4611                	li	a2,4
  ff60400f74:	4581                	li	a1,0
  ff60400f76:	fe043503          	ld	a0,-32(s0)
  ff60400f7a:	d48ff0ef          	jal	ra,ff604004c2 <dw_pcie_read_dbi>
  ff60400f7e:	87aa                	mv	a5,a0
  ff60400f80:	2781                	sext.w	a5,a5
  ff60400f82:	fcf42e23          	sw	a5,-36(s0)
	val &= 0xffff0000;
  ff60400f86:	fdc42783          	lw	a5,-36(s0)
  ff60400f8a:	873e                	mv	a4,a5
  ff60400f8c:	77c1                	lui	a5,0xffff0
  ff60400f8e:	8ff9                	and	a5,a5,a4
  ff60400f90:	2781                	sext.w	a5,a5
  ff60400f92:	fcf42e23          	sw	a5,-36(s0)
	val |= PCI_COMMAND_IO | PCI_COMMAND_MEMORY |
  ff60400f96:	fdc42783          	lw	a5,-36(s0)
  ff60400f9a:	1077e793          	ori	a5,a5,263
  ff60400f9e:	2781                	sext.w	a5,a5
  ff60400fa0:	fcf42e23          	sw	a5,-36(s0)
		PCI_COMMAND_MASTER | PCI_COMMAND_SERR;
	dw_pcie_write_dbi(pci, DW_PCIE_CDM, PCI_COMMAND, val, 0x4);
  ff60400fa4:	fdc42783          	lw	a5,-36(s0)
  ff60400fa8:	4711                	li	a4,4
  ff60400faa:	86be                	mv	a3,a5
  ff60400fac:	4611                	li	a2,4
  ff60400fae:	4581                	li	a1,0
  ff60400fb0:	fe043503          	ld	a0,-32(s0)
  ff60400fb4:	ff6ff0ef          	jal	ra,ff604007aa <dw_pcie_write_dbi>
						  pp->io_bus_addr, pp->io_size);
	}
*/

    //dw_pcie_prog_outbound_atu(pci, 0, PCIE_ATU_TYPE_IO, 0xd000000080001000, 0x1a00000000120000, 0x80ff0000);
    dw_pcie_prog_outbound_atu(pci, 0, PCIE_ATU_TYPE_CFG1, pp->cfg_bar1, 0x1000000000000000, 0x80000);
  ff60400fb8:	fc843783          	ld	a5,-56(s0)
  ff60400fbc:	6b94                	ld	a3,16(a5)
  ff60400fbe:	000807b7          	lui	a5,0x80
  ff60400fc2:	4705                	li	a4,1
  ff60400fc4:	1772                	slli	a4,a4,0x3c
  ff60400fc6:	4615                	li	a2,5
  ff60400fc8:	4581                	li	a1,0
  ff60400fca:	fe043503          	ld	a0,-32(s0)
  ff60400fce:	9edff0ef          	jal	ra,ff604009ba <dw_pcie_prog_outbound_atu>
    dw_pcie_prog_outbound_atu(pci, 1, PCIE_ATU_TYPE_CFG0, pp->cfg_bar0, 0x1100000000000000, 0x80000);
  ff60400fd2:	fc843783          	ld	a5,-56(s0)
  ff60400fd6:	6794                	ld	a3,8(a5)
  ff60400fd8:	000807b7          	lui	a5,0x80
  ff60400fdc:	4745                	li	a4,17
  ff60400fde:	1762                	slli	a4,a4,0x38
  ff60400fe0:	4611                	li	a2,4
  ff60400fe2:	4585                	li	a1,1
  ff60400fe4:	fe043503          	ld	a0,-32(s0)
  ff60400fe8:	9d3ff0ef          	jal	ra,ff604009ba <dw_pcie_prog_outbound_atu>
    dw_pcie_prog_outbound_atu(pci, 2, PCIE_ATU_TYPE_MEM, pp->mem_base, 0x2000000000000000, pp->mem_size);
  ff60400fec:	fc843783          	ld	a5,-56(s0)
  ff60400ff0:	7b94                	ld	a3,48(a5)
  ff60400ff2:	fc843783          	ld	a5,-56(s0)
  ff60400ff6:	7f9c                	ld	a5,56(a5)
  ff60400ff8:	4705                	li	a4,1
  ff60400ffa:	1776                	slli	a4,a4,0x3d
  ff60400ffc:	4601                	li	a2,0
  ff60400ffe:	4589                	li	a1,2
  ff60401000:	fe043503          	ld	a0,-32(s0)
  ff60401004:	9b7ff0ef          	jal	ra,ff604009ba <dw_pcie_prog_outbound_atu>
	dw_pcie_wr_own_conf(pp, PCI_BASE_ADDRESS_0, 4, 0);
  ff60401008:	4681                	li	a3,0
  ff6040100a:	4611                	li	a2,4
  ff6040100c:	45c1                	li	a1,16
  ff6040100e:	fc843503          	ld	a0,-56(s0)
  ff60401012:	b11ff0ef          	jal	ra,ff60400b22 <dw_pcie_wr_own_conf>

	/* Program correct class for RC */
	dw_pcie_wr_own_conf(pp, PCI_CLASS_DEVICE, 2, PCI_CLASS_BRIDGE_PCI);
  ff60401016:	60400693          	li	a3,1540
  ff6040101a:	4609                	li	a2,2
  ff6040101c:	45a9                	li	a1,10
  ff6040101e:	fc843503          	ld	a0,-56(s0)
  ff60401022:	b01ff0ef          	jal	ra,ff60400b22 <dw_pcie_wr_own_conf>

	dw_pcie_rd_own_conf(pp, PCIE_LINK_WIDTH_SPEED_CONTROL, 4, &val);
  ff60401026:	fdc40793          	addi	a5,s0,-36
  ff6040102a:	86be                	mv	a3,a5
  ff6040102c:	4611                	li	a2,4
  ff6040102e:	6785                	lui	a5,0x1
  ff60401030:	80c78593          	addi	a1,a5,-2036 # 80c <__raw_writel-0xff603ff7f4>
  ff60401034:	fc843503          	ld	a0,-56(s0)
  ff60401038:	a8dff0ef          	jal	ra,ff60400ac4 <dw_pcie_rd_own_conf>
	val |= PORT_LOGIC_SPEED_CHANGE;
  ff6040103c:	fdc42783          	lw	a5,-36(s0)
  ff60401040:	873e                	mv	a4,a5
  ff60401042:	000207b7          	lui	a5,0x20
  ff60401046:	8fd9                	or	a5,a5,a4
  ff60401048:	2781                	sext.w	a5,a5
  ff6040104a:	fcf42e23          	sw	a5,-36(s0)
	dw_pcie_wr_own_conf(pp, PCIE_LINK_WIDTH_SPEED_CONTROL, 4, val);
  ff6040104e:	fdc42783          	lw	a5,-36(s0)
  ff60401052:	86be                	mv	a3,a5
  ff60401054:	4611                	li	a2,4
  ff60401056:	6785                	lui	a5,0x1
  ff60401058:	80c78593          	addi	a1,a5,-2036 # 80c <__raw_writel-0xff603ff7f4>
  ff6040105c:	fc843503          	ld	a0,-56(s0)
  ff60401060:	ac3ff0ef          	jal	ra,ff60400b22 <dw_pcie_wr_own_conf>

	dw_pcie_dbi_ro_wr_dis(pci);
  ff60401064:	fe043503          	ld	a0,-32(s0)
  ff60401068:	974ff0ef          	jal	ra,ff604001dc <dw_pcie_dbi_ro_wr_dis>
}
  ff6040106c:	0001                	nop
  ff6040106e:	70e2                	ld	ra,56(sp)
  ff60401070:	7442                	ld	s0,48(sp)
  ff60401072:	6121                	addi	sp,sp,64
  ff60401074:	8082                	ret

000000ff60401076 <pre_platform_init>:


int pre_platform_init(void)
{
  ff60401076:	1141                	addi	sp,sp,-16
  ff60401078:	e422                	sd	s0,8(sp)
  ff6040107a:	0800                	addi	s0,sp,16
    // configure clock and resets
    
    // phy_power_on
    return 0;
  ff6040107c:	4781                	li	a5,0
}
  ff6040107e:	853e                	mv	a0,a5
  ff60401080:	6422                	ld	s0,8(sp)
  ff60401082:	0141                	addi	sp,sp,16
  ff60401084:	8082                	ret

000000ff60401086 <dw_pcie_host_init>:


int dw_pcie_host_init(struct pcie_port *pp)
{
  ff60401086:	1101                	addi	sp,sp,-32
  ff60401088:	ec06                	sd	ra,24(sp)
  ff6040108a:	e822                	sd	s0,16(sp)
  ff6040108c:	1000                	addi	s0,sp,32
  ff6040108e:	fea43423          	sd	a0,-24(s0)
	//struct dw_pcie *pci = to_dw_pcie_from_pp(pp);

    pre_platform_init();// pcie_init_2_3_3
  ff60401092:	fe5ff0ef          	jal	ra,ff60401076 <pre_platform_init>

    dw_pcie_setup_rc(pp);
  ff60401096:	fe843503          	ld	a0,-24(s0)
  ff6040109a:	de5ff0ef          	jal	ra,ff60400e7e <dw_pcie_setup_rc>

    //post_platform_init(pci); // pcie_establish_link

    return 0;
  ff6040109e:	4781                	li	a5,0
}
  ff604010a0:	853e                	mv	a0,a5
  ff604010a2:	60e2                	ld	ra,24(sp)
  ff604010a4:	6442                	ld	s0,16(sp)
  ff604010a6:	6105                	addi	sp,sp,32
  ff604010a8:	8082                	ret

000000ff604010aa <pcie_init>:


int pcie_init(struct dw_pcie *pci)
{
  ff604010aa:	1101                	addi	sp,sp,-32
  ff604010ac:	ec06                	sd	ra,24(sp)
  ff604010ae:	e822                	sd	s0,16(sp)
  ff604010b0:	1000                	addi	s0,sp,32
  ff604010b2:	fea43423          	sd	a0,-24(s0)
    //phy_init();
    
    dw_pcie_host_init(&pci->pp);
  ff604010b6:	fe843783          	ld	a5,-24(s0)
  ff604010ba:	05878793          	addi	a5,a5,88
  ff604010be:	853e                	mv	a0,a5
  ff604010c0:	fc7ff0ef          	jal	ra,ff60401086 <dw_pcie_host_init>

    //bus_enumerate();

    return 0;
  ff604010c4:	4781                	li	a5,0
}
  ff604010c6:	853e                	mv	a0,a5
  ff604010c8:	60e2                	ld	ra,24(sp)
  ff604010ca:	6442                	ld	s0,16(sp)
  ff604010cc:	6105                	addi	sp,sp,32
  ff604010ce:	8082                	ret

000000ff604010d0 <main>:
#include "pcie_designware.h"

int main (int argc, char *argv[])
{
  ff604010d0:	1101                	addi	sp,sp,-32
  ff604010d2:	ec06                	sd	ra,24(sp)
  ff604010d4:	e822                	sd	s0,16(sp)
  ff604010d6:	1000                	addi	s0,sp,32
  ff604010d8:	87aa                	mv	a5,a0
  ff604010da:	feb43023          	sd	a1,-32(s0)
  ff604010de:	fef42623          	sw	a5,-20(s0)
    //struct dw_pcie pci;

    //pcie_init(&pci);
	pci_platform_init();
  ff604010e2:	742000ef          	jal	ra,ff60401824 <pci_platform_init>

    return 0;
  ff604010e6:	4781                	li	a5,0
}
  ff604010e8:	853e                	mv	a0,a5
  ff604010ea:	60e2                	ld	ra,24(sp)
  ff604010ec:	6442                	ld	s0,16(sp)
  ff604010ee:	6105                	addi	sp,sp,32
  ff604010f0:	8082                	ret

000000ff604010f2 <__raw_writel>:
{
  ff604010f2:	1101                	addi	sp,sp,-32
  ff604010f4:	ec22                	sd	s0,24(sp)
  ff604010f6:	1000                	addi	s0,sp,32
  ff604010f8:	87aa                	mv	a5,a0
  ff604010fa:	feb43023          	sd	a1,-32(s0)
  ff604010fe:	fef42623          	sw	a5,-20(s0)
        asm volatile("sw %0, 0(%1)" : : "r" (v), "r" (a));
  ff60401102:	fec42783          	lw	a5,-20(s0)
  ff60401106:	fe043703          	ld	a4,-32(s0)
  ff6040110a:	c31c                	sw	a5,0(a4)
}
  ff6040110c:	0001                	nop
  ff6040110e:	6462                	ld	s0,24(sp)
  ff60401110:	6105                	addi	sp,sp,32
  ff60401112:	8082                	ret

000000ff60401114 <__raw_writeq>:
{
  ff60401114:	1101                	addi	sp,sp,-32
  ff60401116:	ec22                	sd	s0,24(sp)
  ff60401118:	1000                	addi	s0,sp,32
  ff6040111a:	87aa                	mv	a5,a0
  ff6040111c:	feb43023          	sd	a1,-32(s0)
  ff60401120:	fef42623          	sw	a5,-20(s0)
        asm volatile("sd %0, 0(%1)" : : "r" (v), "r" (a));
  ff60401124:	fec42783          	lw	a5,-20(s0)
  ff60401128:	fe043703          	ld	a4,-32(s0)
  ff6040112c:	e31c                	sd	a5,0(a4)
}
  ff6040112e:	0001                	nop
  ff60401130:	6462                	ld	s0,24(sp)
  ff60401132:	6105                	addi	sp,sp,32
  ff60401134:	8082                	ret

000000ff60401136 <__raw_readl>:
{
  ff60401136:	7179                	addi	sp,sp,-48
  ff60401138:	f422                	sd	s0,40(sp)
  ff6040113a:	1800                	addi	s0,sp,48
  ff6040113c:	fca43c23          	sd	a0,-40(s0)
        asm volatile("lw %0, 0(%1)" : "=r" (v) : "r" (a));
  ff60401140:	fd843783          	ld	a5,-40(s0)
  ff60401144:	439c                	lw	a5,0(a5)
  ff60401146:	fef42623          	sw	a5,-20(s0)
            return v;
  ff6040114a:	fec42783          	lw	a5,-20(s0)
}
  ff6040114e:	853e                	mv	a0,a5
  ff60401150:	7422                	ld	s0,40(sp)
  ff60401152:	6145                	addi	sp,sp,48
  ff60401154:	8082                	ret

000000ff60401156 <__raw_readq>:
static inline uint32_t __raw_readq(const uint64_t a)
{
  ff60401156:	7179                	addi	sp,sp,-48
  ff60401158:	f422                	sd	s0,40(sp)
  ff6040115a:	1800                	addi	s0,sp,48
  ff6040115c:	fca43c23          	sd	a0,-40(s0)
        uint32_t v;

        asm volatile("ld %0, 0(%1)" : "=r" (v) : "r" (a));
  ff60401160:	fd843783          	ld	a5,-40(s0)
  ff60401164:	639c                	ld	a5,0(a5)
  ff60401166:	fef42623          	sw	a5,-20(s0)
            return v;
  ff6040116a:	fec42783          	lw	a5,-20(s0)
}
  ff6040116e:	853e                	mv	a0,a5
  ff60401170:	7422                	ld	s0,40(sp)
  ff60401172:	6145                	addi	sp,sp,48
  ff60401174:	8082                	ret

000000ff60401176 <read_apb>:
        .pp.mem_size = PCIE_CORE_MEM_SIZE,
    },
};

uint32_t read_apb(uint64_t addr, uint8_t port)
{
  ff60401176:	7179                	addi	sp,sp,-48
  ff60401178:	f406                	sd	ra,40(sp)
  ff6040117a:	f022                	sd	s0,32(sp)
  ff6040117c:	1800                	addi	s0,sp,48
  ff6040117e:	fca43c23          	sd	a0,-40(s0)
  ff60401182:	87ae                	mv	a5,a1
  ff60401184:	fcf40ba3          	sb	a5,-41(s0)
    uint32_t data;
#ifdef IPBENCH
    apb_read_c(addr, &data, port);
#else
    data = readl(addr);
  ff60401188:	fd843503          	ld	a0,-40(s0)
  ff6040118c:	fabff0ef          	jal	ra,ff60401136 <__raw_readl>
  ff60401190:	87aa                	mv	a5,a0
  ff60401192:	fef42623          	sw	a5,-20(s0)
#endif
    printf("ReadAPB: addr: 0x%08x; data: 0x%08x, port: %d\n", addr, data, port);
  ff60401196:	fd744783          	lbu	a5,-41(s0)
  ff6040119a:	0007871b          	sext.w	a4,a5
  ff6040119e:	fec42783          	lw	a5,-20(s0)
  ff604011a2:	86ba                	mv	a3,a4
  ff604011a4:	863e                	mv	a2,a5
  ff604011a6:	fd843583          	ld	a1,-40(s0)
  ff604011aa:	00001517          	auipc	a0,0x1
  ff604011ae:	eee50513          	addi	a0,a0,-274 # ff60402098 <etext+0x98>
  ff604011b2:	e91fe0ef          	jal	ra,ff60400042 <printf>
    return data;
  ff604011b6:	fec42783          	lw	a5,-20(s0)
}
  ff604011ba:	853e                	mv	a0,a5
  ff604011bc:	70a2                	ld	ra,40(sp)
  ff604011be:	7402                	ld	s0,32(sp)
  ff604011c0:	6145                	addi	sp,sp,48
  ff604011c2:	8082                	ret

000000ff604011c4 <write_apb>:

void write_apb(uint64_t addr, uint32_t data, uint8_t port)
{
  ff604011c4:	1101                	addi	sp,sp,-32
  ff604011c6:	ec06                	sd	ra,24(sp)
  ff604011c8:	e822                	sd	s0,16(sp)
  ff604011ca:	1000                	addi	s0,sp,32
  ff604011cc:	fea43423          	sd	a0,-24(s0)
  ff604011d0:	87ae                	mv	a5,a1
  ff604011d2:	8732                	mv	a4,a2
  ff604011d4:	fef42223          	sw	a5,-28(s0)
  ff604011d8:	87ba                	mv	a5,a4
  ff604011da:	fef401a3          	sb	a5,-29(s0)
    printf("WriteAPB: addr: 0x%llx; data: 0x%x port: %d\n", addr, data, port);
  ff604011de:	fe344783          	lbu	a5,-29(s0)
  ff604011e2:	0007871b          	sext.w	a4,a5
  ff604011e6:	fe442783          	lw	a5,-28(s0)
  ff604011ea:	86ba                	mv	a3,a4
  ff604011ec:	863e                	mv	a2,a5
  ff604011ee:	fe843583          	ld	a1,-24(s0)
  ff604011f2:	00001517          	auipc	a0,0x1
  ff604011f6:	ed650513          	addi	a0,a0,-298 # ff604020c8 <etext+0xc8>
  ff604011fa:	e49fe0ef          	jal	ra,ff60400042 <printf>
#ifdef IPBENCH
    apb_write_c(addr, data, port);
#else
    writel(addr, data);
  ff604011fe:	fe442783          	lw	a5,-28(s0)
  ff60401202:	fe843583          	ld	a1,-24(s0)
  ff60401206:	853e                	mv	a0,a5
  ff60401208:	eebff0ef          	jal	ra,ff604010f2 <__raw_writel>
#endif
}
  ff6040120c:	0001                	nop
  ff6040120e:	60e2                	ld	ra,24(sp)
  ff60401210:	6442                	ld	s0,16(sp)
  ff60401212:	6105                	addi	sp,sp,32
  ff60401214:	8082                	ret

000000ff60401216 <duowen_get_link_mode>:
    } while(current < next);
}
#endif

static uint8_t duowen_get_link_mode(struct duowen_pcie_subsystem *pcie_subsystem)
{
  ff60401216:	1101                	addi	sp,sp,-32
  ff60401218:	ec22                	sd	s0,24(sp)
  ff6040121a:	1000                	addi	s0,sp,32
  ff6040121c:	fea43423          	sd	a0,-24(s0)
    return DEFAULT_LINK_MODE;
  ff60401220:	478d                	li	a5,3
}
  ff60401222:	853e                	mv	a0,a5
  ff60401224:	6462                	ld	s0,24(sp)
  ff60401226:	6105                	addi	sp,sp,32
  ff60401228:	8082                	ret

000000ff6040122a <reset_init>:

void reset_init(struct duowen_pcie_subsystem *pcie_subsystem)
{
  ff6040122a:	7139                	addi	sp,sp,-64
  ff6040122c:	fc06                	sd	ra,56(sp)
  ff6040122e:	f822                	sd	s0,48(sp)
  ff60401230:	0080                	addi	s0,sp,64
  ff60401232:	fca43423          	sd	a0,-56(s0)
    uint64_t base = pcie_subsystem->cfg_apb[SUBSYS];
  ff60401236:	fc843783          	ld	a5,-56(s0)
  ff6040123a:	739c                	ld	a5,32(a5)
  ff6040123c:	fef43023          	sd	a5,-32(s0)
    uint8_t port = APB_PORT_SUBSYS;
  ff60401240:	47a1                	li	a5,8
  ff60401242:	fcf40fa3          	sb	a5,-33(s0)
    uint8_t mode = duowen_get_link_mode(pcie_subsystem);
  ff60401246:	fc843503          	ld	a0,-56(s0)
  ff6040124a:	fcdff0ef          	jal	ra,ff60401216 <duowen_get_link_mode>
  ff6040124e:	87aa                	mv	a5,a0
  ff60401250:	fcf40f23          	sb	a5,-34(s0)
    uint32_t data = 0;
  ff60401254:	fe042623          	sw	zero,-20(s0)

    write_apb((base + RESET_PHY), 0x10, port);
  ff60401258:	fe043783          	ld	a5,-32(s0)
  ff6040125c:	07c1                	addi	a5,a5,16
  ff6040125e:	fdf44703          	lbu	a4,-33(s0)
  ff60401262:	863a                	mv	a2,a4
  ff60401264:	45c1                	li	a1,16
  ff60401266:	853e                	mv	a0,a5
  ff60401268:	f5dff0ef          	jal	ra,ff604011c4 <write_apb>
    write_apb((base + SRAM_CONTROL), 0x0, port);
  ff6040126c:	fe043783          	ld	a5,-32(s0)
  ff60401270:	07f1                	addi	a5,a5,28
  ff60401272:	fdf44703          	lbu	a4,-33(s0)
  ff60401276:	863a                	mv	a2,a4
  ff60401278:	4581                	li	a1,0
  ff6040127a:	853e                	mv	a0,a5
  ff6040127c:	f49ff0ef          	jal	ra,ff604011c4 <write_apb>
    write_apb((base + REFCLK_CONTROL), 0x2, port);
  ff60401280:	fe043783          	ld	a5,-32(s0)
  ff60401284:	07e1                	addi	a5,a5,24
  ff60401286:	fdf44703          	lbu	a4,-33(s0)
  ff6040128a:	863a                	mv	a2,a4
  ff6040128c:	4589                	li	a1,2
  ff6040128e:	853e                	mv	a0,a5
  ff60401290:	f35ff0ef          	jal	ra,ff604011c4 <write_apb>
    // #200ns
    write_apb((base + RESET_PHY), 0xf, port);
  ff60401294:	fe043783          	ld	a5,-32(s0)
  ff60401298:	07c1                	addi	a5,a5,16
  ff6040129a:	fdf44703          	lbu	a4,-33(s0)
  ff6040129e:	863a                	mv	a2,a4
  ff604012a0:	45bd                	li	a1,15
  ff604012a2:	853e                	mv	a0,a5
  ff604012a4:	f21ff0ef          	jal	ra,ff604011c4 <write_apb>
    // #100ns

    write_apb((base + RESET_CORE_X16), 0xff, port);
  ff604012a8:	fdf44783          	lbu	a5,-33(s0)
  ff604012ac:	863e                	mv	a2,a5
  ff604012ae:	0ff00593          	li	a1,255
  ff604012b2:	fe043503          	ld	a0,-32(s0)
  ff604012b6:	f0fff0ef          	jal	ra,ff604011c4 <write_apb>
    write_apb((base + RESET_CORE_X8), 0xff, port);
  ff604012ba:	fe043783          	ld	a5,-32(s0)
  ff604012be:	0791                	addi	a5,a5,4
  ff604012c0:	fdf44703          	lbu	a4,-33(s0)
  ff604012c4:	863a                	mv	a2,a4
  ff604012c6:	0ff00593          	li	a1,255
  ff604012ca:	853e                	mv	a0,a5
  ff604012cc:	ef9ff0ef          	jal	ra,ff604011c4 <write_apb>
    write_apb((base + RESET_CORE_X4_0), 0xff, port);
  ff604012d0:	fe043783          	ld	a5,-32(s0)
  ff604012d4:	07a1                	addi	a5,a5,8
  ff604012d6:	fdf44703          	lbu	a4,-33(s0)
  ff604012da:	863a                	mv	a2,a4
  ff604012dc:	0ff00593          	li	a1,255
  ff604012e0:	853e                	mv	a0,a5
  ff604012e2:	ee3ff0ef          	jal	ra,ff604011c4 <write_apb>
    write_apb((base + RESET_CORE_X4_1), 0xff, port);
  ff604012e6:	fe043783          	ld	a5,-32(s0)
  ff604012ea:	07b1                	addi	a5,a5,12
  ff604012ec:	fdf44703          	lbu	a4,-33(s0)
  ff604012f0:	863a                	mv	a2,a4
  ff604012f2:	0ff00593          	li	a1,255
  ff604012f6:	853e                	mv	a0,a5
  ff604012f8:	ecdff0ef          	jal	ra,ff604011c4 <write_apb>
#ifndef TEST
    while ((data & 0xf) != 0xf) {
  ff604012fc:	a831                	j	ff60401318 <reset_init+0xee>
        data = read_apb((base + SRAM_STATUS), port);
  ff604012fe:	fe043783          	ld	a5,-32(s0)
  ff60401302:	02078793          	addi	a5,a5,32
  ff60401306:	fdf44703          	lbu	a4,-33(s0)
  ff6040130a:	85ba                	mv	a1,a4
  ff6040130c:	853e                	mv	a0,a5
  ff6040130e:	e69ff0ef          	jal	ra,ff60401176 <read_apb>
  ff60401312:	87aa                	mv	a5,a0
  ff60401314:	fef42623          	sw	a5,-20(s0)
    while ((data & 0xf) != 0xf) {
  ff60401318:	fec42783          	lw	a5,-20(s0)
  ff6040131c:	8bbd                	andi	a5,a5,15
  ff6040131e:	2781                	sext.w	a5,a5
  ff60401320:	873e                	mv	a4,a5
  ff60401322:	47bd                	li	a5,15
  ff60401324:	fcf71de3          	bne	a4,a5,ff604012fe <reset_init+0xd4>
    }
#endif
    write_apb((base + SRAM_CONTROL), 0x55, port);
  ff60401328:	fe043783          	ld	a5,-32(s0)
  ff6040132c:	07f1                	addi	a5,a5,28
  ff6040132e:	fdf44703          	lbu	a4,-33(s0)
  ff60401332:	863a                	mv	a2,a4
  ff60401334:	05500593          	li	a1,85
  ff60401338:	853e                	mv	a0,a5
  ff6040133a:	e8bff0ef          	jal	ra,ff604011c4 <write_apb>
    //write_apb((base + RESET_PHY), 0xff, port);
}
  ff6040133e:	0001                	nop
  ff60401340:	70e2                	ld	ra,56(sp)
  ff60401342:	7442                	ld	s0,48(sp)
  ff60401344:	6121                	addi	sp,sp,64
  ff60401346:	8082                	ret

000000ff60401348 <subsys_link_init_pre>:

static void subsys_link_init_pre(struct duowen_pcie_subsystem *pcie_subsystem)
{
  ff60401348:	7139                	addi	sp,sp,-64
  ff6040134a:	fc06                	sd	ra,56(sp)
  ff6040134c:	f822                	sd	s0,48(sp)
  ff6040134e:	0080                	addi	s0,sp,64
  ff60401350:	fca43423          	sd	a0,-56(s0)
    uint64_t base = pcie_subsystem->cfg_apb[SUBSYS];
  ff60401354:	fc843783          	ld	a5,-56(s0)
  ff60401358:	739c                	ld	a5,32(a5)
  ff6040135a:	fef43423          	sd	a5,-24(s0)
    struct dw_pcie *controller = pcie_subsystem->controller;
  ff6040135e:	fc843783          	ld	a5,-56(s0)
  ff60401362:	7b9c                	ld	a5,48(a5)
  ff60401364:	fcf43c23          	sd	a5,-40(s0)
    uint8_t port = APB_PORT_SUBSYS;
  ff60401368:	47a1                	li	a5,8
  ff6040136a:	fef403a3          	sb	a5,-25(s0)
    uint8_t link_mode = pcie_subsystem->link_mode;
  ff6040136e:	fc843783          	ld	a5,-56(s0)
  ff60401372:	0287c783          	lbu	a5,40(a5)
  ff60401376:	fcf40ba3          	sb	a5,-41(s0)

    //assert(link_mode != LINK_MODE_INVALID);

    // #10ns
    write_apb((base + SUBSYS_CONTROL), link_mode, port);
  ff6040137a:	fe843783          	ld	a5,-24(s0)
  ff6040137e:	07d1                	addi	a5,a5,20
  ff60401380:	fd744703          	lbu	a4,-41(s0)
  ff60401384:	2701                	sext.w	a4,a4
  ff60401386:	fe744683          	lbu	a3,-25(s0)
  ff6040138a:	8636                	mv	a2,a3
  ff6040138c:	85ba                	mv	a1,a4
  ff6040138e:	853e                	mv	a0,a5
  ff60401390:	e35ff0ef          	jal	ra,ff604011c4 <write_apb>

    switch (link_mode) {
  ff60401394:	fd744783          	lbu	a5,-41(s0)
  ff60401398:	2781                	sext.w	a5,a5
  ff6040139a:	86be                	mv	a3,a5
  ff6040139c:	470d                	li	a4,3
  ff6040139e:	20e68763          	beq	a3,a4,ff604015ac <subsys_link_init_pre+0x264>
  ff604013a2:	86be                	mv	a3,a5
  ff604013a4:	470d                	li	a4,3
  ff604013a6:	2ad74263          	blt	a4,a3,ff6040164a <subsys_link_init_pre+0x302>
  ff604013aa:	86be                	mv	a3,a5
  ff604013ac:	4709                	li	a4,2
  ff604013ae:	14e68f63          	beq	a3,a4,ff6040150c <subsys_link_init_pre+0x1c4>
  ff604013b2:	86be                	mv	a3,a5
  ff604013b4:	4709                	li	a4,2
  ff604013b6:	28d74a63          	blt	a4,a3,ff6040164a <subsys_link_init_pre+0x302>
  ff604013ba:	c791                	beqz	a5,ff604013c6 <subsys_link_init_pre+0x7e>
  ff604013bc:	873e                	mv	a4,a5
  ff604013be:	4785                	li	a5,1
  ff604013c0:	0af70563          	beq	a4,a5,ff6040146a <subsys_link_init_pre+0x122>
  ff604013c4:	a459                	j	ff6040164a <subsys_link_init_pre+0x302>
        (controller + X16)->order = 0xff;
        (controller + X8)->order = 0xff;
        (controller + X4_0)->order = 0;
        (controller + X4_1)->order = 0xff;
#else
        (controller + X16)->lane_num = 4;
  ff604013c6:	fd843783          	ld	a5,-40(s0)
  ff604013ca:	4711                	li	a4,4
  ff604013cc:	c3b8                	sw	a4,64(a5)
        (controller + X8)->lane_num = 4;
  ff604013ce:	fd843783          	ld	a5,-40(s0)
  ff604013d2:	10078793          	addi	a5,a5,256
  ff604013d6:	4711                	li	a4,4
  ff604013d8:	c3b8                	sw	a4,64(a5)
        (controller + X4_0)->lane_num = 4;
  ff604013da:	fd843783          	ld	a5,-40(s0)
  ff604013de:	20078793          	addi	a5,a5,512
  ff604013e2:	4711                	li	a4,4
  ff604013e4:	c3b8                	sw	a4,64(a5)
        (controller + X4_1)->lane_num = 4;
  ff604013e6:	fd843783          	ld	a5,-40(s0)
  ff604013ea:	30078793          	addi	a5,a5,768
  ff604013ee:	4711                	li	a4,4
  ff604013f0:	c3b8                	sw	a4,64(a5)

        (controller + X16)->active = true;
  ff604013f2:	fd843783          	ld	a5,-40(s0)
  ff604013f6:	4705                	li	a4,1
  ff604013f8:	0ee78c23          	sb	a4,248(a5)
        (controller + X8)->active = true;
  ff604013fc:	fd843783          	ld	a5,-40(s0)
  ff60401400:	10078793          	addi	a5,a5,256
  ff60401404:	4705                	li	a4,1
  ff60401406:	0ee78c23          	sb	a4,248(a5)
        (controller + X4_0)->active = true;
  ff6040140a:	fd843783          	ld	a5,-40(s0)
  ff6040140e:	20078793          	addi	a5,a5,512
  ff60401412:	4705                	li	a4,1
  ff60401414:	0ee78c23          	sb	a4,248(a5)
        (controller + X4_1)->active = true;
  ff60401418:	fd843783          	ld	a5,-40(s0)
  ff6040141c:	30078793          	addi	a5,a5,768
  ff60401420:	4705                	li	a4,1
  ff60401422:	0ee78c23          	sb	a4,248(a5)

        (controller + X16)->order = 0;
  ff60401426:	fd843783          	ld	a5,-40(s0)
  ff6040142a:	040782a3          	sb	zero,69(a5)
        (controller + X8)->order = 1;
  ff6040142e:	fd843783          	ld	a5,-40(s0)
  ff60401432:	10078793          	addi	a5,a5,256
  ff60401436:	4705                	li	a4,1
  ff60401438:	04e782a3          	sb	a4,69(a5)
        (controller + X4_0)->order = 2;
  ff6040143c:	fd843783          	ld	a5,-40(s0)
  ff60401440:	20078793          	addi	a5,a5,512
  ff60401444:	4709                	li	a4,2
  ff60401446:	04e782a3          	sb	a4,69(a5)
        (controller + X4_1)->order = 3;
  ff6040144a:	fd843783          	ld	a5,-40(s0)
  ff6040144e:	30078793          	addi	a5,a5,768
  ff60401452:	470d                	li	a4,3
  ff60401454:	04e782a3          	sb	a4,69(a5)
#endif
        base = pcie_subsystem->cfg_apb[X4_0];
  ff60401458:	fc843783          	ld	a5,-56(s0)
  ff6040145c:	6b9c                	ld	a5,16(a5)
  ff6040145e:	fef43423          	sd	a5,-24(s0)
        port = APB_PORT_X4_0;
  ff60401462:	4799                	li	a5,6
  ff60401464:	fef403a3          	sb	a5,-25(s0)
        break;
  ff60401468:	a2cd                	j	ff6040164a <subsys_link_init_pre+0x302>
        (controller + X16)->order = 0xff;
        (controller + X8)->order = 0xff;
        (controller + X4_0)->order = 0xff;
        (controller + X4_1)->order = 0;
#else
        (controller + X16)->lane_num = 8;
  ff6040146a:	fd843783          	ld	a5,-40(s0)
  ff6040146e:	4721                	li	a4,8
  ff60401470:	c3b8                	sw	a4,64(a5)
        (controller + X8)->lane_num = 4;
  ff60401472:	fd843783          	ld	a5,-40(s0)
  ff60401476:	10078793          	addi	a5,a5,256
  ff6040147a:	4711                	li	a4,4
  ff6040147c:	c3b8                	sw	a4,64(a5)
        (controller + X4_0)->lane_num = 0;
  ff6040147e:	fd843783          	ld	a5,-40(s0)
  ff60401482:	20078793          	addi	a5,a5,512
  ff60401486:	0407a023          	sw	zero,64(a5)
        (controller + X4_1)->lane_num = 4;
  ff6040148a:	fd843783          	ld	a5,-40(s0)
  ff6040148e:	30078793          	addi	a5,a5,768
  ff60401492:	4711                	li	a4,4
  ff60401494:	c3b8                	sw	a4,64(a5)

        (controller + X16)->active = true;
  ff60401496:	fd843783          	ld	a5,-40(s0)
  ff6040149a:	4705                	li	a4,1
  ff6040149c:	0ee78c23          	sb	a4,248(a5)
        (controller + X8)->active = true;
  ff604014a0:	fd843783          	ld	a5,-40(s0)
  ff604014a4:	10078793          	addi	a5,a5,256
  ff604014a8:	4705                	li	a4,1
  ff604014aa:	0ee78c23          	sb	a4,248(a5)
        (controller + X4_0)->active = false;
  ff604014ae:	fd843783          	ld	a5,-40(s0)
  ff604014b2:	20078793          	addi	a5,a5,512
  ff604014b6:	0e078c23          	sb	zero,248(a5)
        (controller + X4_1)->active = true;
  ff604014ba:	fd843783          	ld	a5,-40(s0)
  ff604014be:	30078793          	addi	a5,a5,768
  ff604014c2:	4705                	li	a4,1
  ff604014c4:	0ee78c23          	sb	a4,248(a5)

        (controller + X16)->order = 0;
  ff604014c8:	fd843783          	ld	a5,-40(s0)
  ff604014cc:	040782a3          	sb	zero,69(a5)
        (controller + X8)->order = 1;
  ff604014d0:	fd843783          	ld	a5,-40(s0)
  ff604014d4:	10078793          	addi	a5,a5,256
  ff604014d8:	4705                	li	a4,1
  ff604014da:	04e782a3          	sb	a4,69(a5)
        (controller + X4_0)->order = 0xff;
  ff604014de:	fd843783          	ld	a5,-40(s0)
  ff604014e2:	20078793          	addi	a5,a5,512
  ff604014e6:	577d                	li	a4,-1
  ff604014e8:	04e782a3          	sb	a4,69(a5)
        (controller + X4_1)->order = 2;
  ff604014ec:	fd843783          	ld	a5,-40(s0)
  ff604014f0:	30078793          	addi	a5,a5,768
  ff604014f4:	4709                	li	a4,2
  ff604014f6:	04e782a3          	sb	a4,69(a5)
#endif
        base = pcie_subsystem->cfg_apb[X4_1];
  ff604014fa:	fc843783          	ld	a5,-56(s0)
  ff604014fe:	6f9c                	ld	a5,24(a5)
  ff60401500:	fef43423          	sd	a5,-24(s0)
        port = APB_PORT_X4_1;
  ff60401504:	479d                	li	a5,7
  ff60401506:	fef403a3          	sb	a5,-25(s0)
        break;
  ff6040150a:	a281                	j	ff6040164a <subsys_link_init_pre+0x302>
        (controller + X16)->order = 0xff;
        (controller + X8)->order = 0;
        (controller + X4_0)->order = 0xff;
        (controller + X4_1)->order = 0xff;
#else
        (controller + X16)->lane_num = 8;
  ff6040150c:	fd843783          	ld	a5,-40(s0)
  ff60401510:	4721                	li	a4,8
  ff60401512:	c3b8                	sw	a4,64(a5)
        (controller + X8)->lane_num = 8;
  ff60401514:	fd843783          	ld	a5,-40(s0)
  ff60401518:	10078793          	addi	a5,a5,256
  ff6040151c:	4721                	li	a4,8
  ff6040151e:	c3b8                	sw	a4,64(a5)
        (controller + X4_0)->lane_num = 0;
  ff60401520:	fd843783          	ld	a5,-40(s0)
  ff60401524:	20078793          	addi	a5,a5,512
  ff60401528:	0407a023          	sw	zero,64(a5)
        (controller + X4_1)->lane_num = 0;
  ff6040152c:	fd843783          	ld	a5,-40(s0)
  ff60401530:	30078793          	addi	a5,a5,768
  ff60401534:	0407a023          	sw	zero,64(a5)

        (controller + X16)->active = true;
  ff60401538:	fd843783          	ld	a5,-40(s0)
  ff6040153c:	4705                	li	a4,1
  ff6040153e:	0ee78c23          	sb	a4,248(a5)
        (controller + X8)->active = true;
  ff60401542:	fd843783          	ld	a5,-40(s0)
  ff60401546:	10078793          	addi	a5,a5,256
  ff6040154a:	4705                	li	a4,1
  ff6040154c:	0ee78c23          	sb	a4,248(a5)
        (controller + X4_0)->active = false;
  ff60401550:	fd843783          	ld	a5,-40(s0)
  ff60401554:	20078793          	addi	a5,a5,512
  ff60401558:	0e078c23          	sb	zero,248(a5)
        (controller + X4_1)->active = false;
  ff6040155c:	fd843783          	ld	a5,-40(s0)
  ff60401560:	30078793          	addi	a5,a5,768
  ff60401564:	0e078c23          	sb	zero,248(a5)

        (controller + X16)->order = 0;
  ff60401568:	fd843783          	ld	a5,-40(s0)
  ff6040156c:	040782a3          	sb	zero,69(a5)
        (controller + X8)->order = 1;
  ff60401570:	fd843783          	ld	a5,-40(s0)
  ff60401574:	10078793          	addi	a5,a5,256
  ff60401578:	4705                	li	a4,1
  ff6040157a:	04e782a3          	sb	a4,69(a5)
        (controller + X4_0)->order = 0xff;
  ff6040157e:	fd843783          	ld	a5,-40(s0)
  ff60401582:	20078793          	addi	a5,a5,512
  ff60401586:	577d                	li	a4,-1
  ff60401588:	04e782a3          	sb	a4,69(a5)
        (controller + X4_1)->order = 0xff;
  ff6040158c:	fd843783          	ld	a5,-40(s0)
  ff60401590:	30078793          	addi	a5,a5,768
  ff60401594:	577d                	li	a4,-1
  ff60401596:	04e782a3          	sb	a4,69(a5)
#endif
        base = pcie_subsystem->cfg_apb[X8];
  ff6040159a:	fc843783          	ld	a5,-56(s0)
  ff6040159e:	679c                	ld	a5,8(a5)
  ff604015a0:	fef43423          	sd	a5,-24(s0)
        port = APB_PORT_X8;
  ff604015a4:	4795                	li	a5,5
  ff604015a6:	fef403a3          	sb	a5,-25(s0)
        break;
  ff604015aa:	a045                	j	ff6040164a <subsys_link_init_pre+0x302>
        (controller + X16)->order = 0;
        (controller + X8)->order = 0xff;
        (controller + X4_0)->order = 0xff;
        (controller + X4_1)->order = 0xff;
#else
        (controller + X16)->lane_num = 16;
  ff604015ac:	fd843783          	ld	a5,-40(s0)
  ff604015b0:	4741                	li	a4,16
  ff604015b2:	c3b8                	sw	a4,64(a5)
        (controller + X8)->lane_num = 0;
  ff604015b4:	fd843783          	ld	a5,-40(s0)
  ff604015b8:	10078793          	addi	a5,a5,256
  ff604015bc:	0407a023          	sw	zero,64(a5)
        (controller + X4_0)->lane_num = 0;
  ff604015c0:	fd843783          	ld	a5,-40(s0)
  ff604015c4:	20078793          	addi	a5,a5,512
  ff604015c8:	0407a023          	sw	zero,64(a5)
        (controller + X4_1)->lane_num = 0;
  ff604015cc:	fd843783          	ld	a5,-40(s0)
  ff604015d0:	30078793          	addi	a5,a5,768
  ff604015d4:	0407a023          	sw	zero,64(a5)

        (controller + X16)->active = true;
  ff604015d8:	fd843783          	ld	a5,-40(s0)
  ff604015dc:	4705                	li	a4,1
  ff604015de:	0ee78c23          	sb	a4,248(a5)
        (controller + X8)->active = false;
  ff604015e2:	fd843783          	ld	a5,-40(s0)
  ff604015e6:	10078793          	addi	a5,a5,256
  ff604015ea:	0e078c23          	sb	zero,248(a5)
        (controller + X4_0)->active = false;
  ff604015ee:	fd843783          	ld	a5,-40(s0)
  ff604015f2:	20078793          	addi	a5,a5,512
  ff604015f6:	0e078c23          	sb	zero,248(a5)
        (controller + X4_1)->active = false;
  ff604015fa:	fd843783          	ld	a5,-40(s0)
  ff604015fe:	30078793          	addi	a5,a5,768
  ff60401602:	0e078c23          	sb	zero,248(a5)

        (controller + X16)->order = 0;
  ff60401606:	fd843783          	ld	a5,-40(s0)
  ff6040160a:	040782a3          	sb	zero,69(a5)
        (controller + X8)->order = 0xff;
  ff6040160e:	fd843783          	ld	a5,-40(s0)
  ff60401612:	10078793          	addi	a5,a5,256
  ff60401616:	577d                	li	a4,-1
  ff60401618:	04e782a3          	sb	a4,69(a5)
        (controller + X4_0)->order = 0xff;
  ff6040161c:	fd843783          	ld	a5,-40(s0)
  ff60401620:	20078793          	addi	a5,a5,512
  ff60401624:	577d                	li	a4,-1
  ff60401626:	04e782a3          	sb	a4,69(a5)
        (controller + X4_1)->order = 0xff;
  ff6040162a:	fd843783          	ld	a5,-40(s0)
  ff6040162e:	30078793          	addi	a5,a5,768
  ff60401632:	577d                	li	a4,-1
  ff60401634:	04e782a3          	sb	a4,69(a5)
#endif
        base = pcie_subsystem->cfg_apb[X16];
  ff60401638:	fc843783          	ld	a5,-56(s0)
  ff6040163c:	639c                	ld	a5,0(a5)
  ff6040163e:	fef43423          	sd	a5,-24(s0)
        port = APB_PORT_X16;
  ff60401642:	4791                	li	a5,4
  ff60401644:	fef403a3          	sb	a5,-25(s0)
        break;
  ff60401648:	0001                	nop
    }

#ifdef CONFIG_DPU_PCIE_ROLE_RC
    write_apb((base + 0), 0xc810010, port);
  ff6040164a:	fe744783          	lbu	a5,-25(s0)
  ff6040164e:	863e                	mv	a2,a5
  ff60401650:	0c8107b7          	lui	a5,0xc810
  ff60401654:	01078593          	addi	a1,a5,16 # c810010 <__raw_writel-0xff53befff0>
  ff60401658:	fe843503          	ld	a0,-24(s0)
  ff6040165c:	b69ff0ef          	jal	ra,ff604011c4 <write_apb>
#else
    write_apb((base + 0), 0xc810000, port);
#endif
}
  ff60401660:	0001                	nop
  ff60401662:	70e2                	ld	ra,56(sp)
  ff60401664:	7442                	ld	s0,48(sp)
  ff60401666:	6121                	addi	sp,sp,64
  ff60401668:	8082                	ret

000000ff6040166a <subsys_link_init_post>:

static void subsys_link_init_post(struct duowen_pcie_subsystem *pcie_subsys)
{
  ff6040166a:	7179                	addi	sp,sp,-48
  ff6040166c:	f406                	sd	ra,40(sp)
  ff6040166e:	f022                	sd	s0,32(sp)
  ff60401670:	1800                	addi	s0,sp,48
  ff60401672:	fca43c23          	sd	a0,-40(s0)
    uint8_t mode = duowen_get_link_mode(pcie_subsys);
  ff60401676:	fd843503          	ld	a0,-40(s0)
  ff6040167a:	b9dff0ef          	jal	ra,ff60401216 <duowen_get_link_mode>
  ff6040167e:	87aa                	mv	a5,a0
  ff60401680:	fef407a3          	sb	a5,-17(s0)

    switch (mode) {
  ff60401684:	fef44783          	lbu	a5,-17(s0)
  ff60401688:	2781                	sext.w	a5,a5
  ff6040168a:	86be                	mv	a3,a5
  ff6040168c:	470d                	li	a4,3
  ff6040168e:	06e68563          	beq	a3,a4,ff604016f8 <subsys_link_init_post+0x8e>
  ff60401692:	86be                	mv	a3,a5
  ff60401694:	470d                	li	a4,3
  ff60401696:	06d74d63          	blt	a4,a3,ff60401710 <subsys_link_init_post+0xa6>
  ff6040169a:	86be                	mv	a3,a5
  ff6040169c:	4709                	li	a4,2
  ff6040169e:	04e68263          	beq	a3,a4,ff604016e2 <subsys_link_init_post+0x78>
  ff604016a2:	86be                	mv	a3,a5
  ff604016a4:	4709                	li	a4,2
  ff604016a6:	06d74563          	blt	a4,a3,ff60401710 <subsys_link_init_post+0xa6>
  ff604016aa:	c791                	beqz	a5,ff604016b6 <subsys_link_init_post+0x4c>
  ff604016ac:	873e                	mv	a4,a5
  ff604016ae:	4785                	li	a5,1
  ff604016b0:	00f70e63          	beq	a4,a5,ff604016cc <subsys_link_init_post+0x62>
#ifdef DPU
            break;
#endif
        break;
    }
} 
  ff604016b4:	a8b1                	j	ff60401710 <subsys_link_init_post+0xa6>
            write_apb(pcie_subsys->cfg_apb[X4_0], 0xc018010, APB_PORT_X4_0);
  ff604016b6:	fd843783          	ld	a5,-40(s0)
  ff604016ba:	6b98                	ld	a4,16(a5)
  ff604016bc:	4619                	li	a2,6
  ff604016be:	0c0187b7          	lui	a5,0xc018
  ff604016c2:	01078593          	addi	a1,a5,16 # c018010 <__raw_writel-0xff543e7ff0>
  ff604016c6:	853a                	mv	a0,a4
  ff604016c8:	afdff0ef          	jal	ra,ff604011c4 <write_apb>
            write_apb(pcie_subsys->cfg_apb[X4_1], 0xc018010, APB_PORT_X4_1);
  ff604016cc:	fd843783          	ld	a5,-40(s0)
  ff604016d0:	6f98                	ld	a4,24(a5)
  ff604016d2:	461d                	li	a2,7
  ff604016d4:	0c0187b7          	lui	a5,0xc018
  ff604016d8:	01078593          	addi	a1,a5,16 # c018010 <__raw_writel-0xff543e7ff0>
  ff604016dc:	853a                	mv	a0,a4
  ff604016de:	ae7ff0ef          	jal	ra,ff604011c4 <write_apb>
            write_apb(pcie_subsys->cfg_apb[X8], 0xc018010, APB_PORT_X8);
  ff604016e2:	fd843783          	ld	a5,-40(s0)
  ff604016e6:	6798                	ld	a4,8(a5)
  ff604016e8:	4615                	li	a2,5
  ff604016ea:	0c0187b7          	lui	a5,0xc018
  ff604016ee:	01078593          	addi	a1,a5,16 # c018010 <__raw_writel-0xff543e7ff0>
  ff604016f2:	853a                	mv	a0,a4
  ff604016f4:	ad1ff0ef          	jal	ra,ff604011c4 <write_apb>
            write_apb(pcie_subsys->cfg_apb[X16], 0xc018010, APB_PORT_X16);
  ff604016f8:	fd843783          	ld	a5,-40(s0)
  ff604016fc:	6398                	ld	a4,0(a5)
  ff604016fe:	4611                	li	a2,4
  ff60401700:	0c0187b7          	lui	a5,0xc018
  ff60401704:	01078593          	addi	a1,a5,16 # c018010 <__raw_writel-0xff543e7ff0>
  ff60401708:	853a                	mv	a0,a4
  ff6040170a:	abbff0ef          	jal	ra,ff604011c4 <write_apb>
        break;
  ff6040170e:	0001                	nop
} 
  ff60401710:	0001                	nop
  ff60401712:	70a2                	ld	ra,40(sp)
  ff60401714:	7402                	ld	s0,32(sp)
  ff60401716:	6145                	addi	sp,sp,48
  ff60401718:	8082                	ret

000000ff6040171a <dw_controller_init>:

void dw_controller_init(struct dw_pcie *pci)
{
  ff6040171a:	1101                	addi	sp,sp,-32
  ff6040171c:	ec22                	sd	s0,24(sp)
  ff6040171e:	1000                	addi	s0,sp,32
  ff60401720:	fea43423          	sd	a0,-24(s0)
}
  ff60401724:	0001                	nop
  ff60401726:	6462                	ld	s0,24(sp)
  ff60401728:	6105                	addi	sp,sp,32
  ff6040172a:	8082                	ret

000000ff6040172c <instance_subsystem>:

void instance_subsystem(struct duowen_pcie_subsystem *pcie_subsystem)
{
  ff6040172c:	7179                	addi	sp,sp,-48
  ff6040172e:	f406                	sd	ra,40(sp)
  ff60401730:	f022                	sd	s0,32(sp)
  ff60401732:	1800                	addi	s0,sp,48
  ff60401734:	fca43c23          	sd	a0,-40(s0)
    uint8_t i;
    memset(pcie_subsystem, 0, sizeof(*pcie_subsystem));
  ff60401738:	03800613          	li	a2,56
  ff6040173c:	4581                	li	a1,0
  ff6040173e:	fd843503          	ld	a0,-40(s0)
  ff60401742:	93bfe0ef          	jal	ra,ff6040007c <memset>

    pcie_subsystem->cfg_apb[X16] = CFG_APB_CORE_X16;
  ff60401746:	fd843783          	ld	a5,-40(s0)
  ff6040174a:	0ff09737          	lui	a4,0xff09
  ff6040174e:	0705                	addi	a4,a4,1
  ff60401750:	0732                	slli	a4,a4,0xc
  ff60401752:	e398                	sd	a4,0(a5)
    pcie_subsystem->cfg_apb[X8] = CFG_APB_CORE_X8;
  ff60401754:	fd843783          	ld	a5,-40(s0)
  ff60401758:	07f85737          	lui	a4,0x7f85
  ff6040175c:	80170713          	addi	a4,a4,-2047 # 7f84801 <__raw_writel-0xff5847b7ff>
  ff60401760:	0736                	slli	a4,a4,0xd
  ff60401762:	e798                	sd	a4,8(a5)
    pcie_subsystem->cfg_apb[X4_0] = CFG_APB_CORE_X4_0;
  ff60401764:	fd843783          	ld	a5,-40(s0)
  ff60401768:	0ff09737          	lui	a4,0xff09
  ff6040176c:	070d                	addi	a4,a4,3
  ff6040176e:	0732                	slli	a4,a4,0xc
  ff60401770:	eb98                	sd	a4,16(a5)
    pcie_subsystem->cfg_apb[X4_1] = CFG_APB_CORE_X4_1;
  ff60401772:	fd843783          	ld	a5,-40(s0)
  ff60401776:	03fc2737          	lui	a4,0x3fc2
  ff6040177a:	40170713          	addi	a4,a4,1025 # 3fc2401 <__raw_writel-0xff5c43dbff>
  ff6040177e:	073a                	slli	a4,a4,0xe
  ff60401780:	ef98                	sd	a4,24(a5)
    pcie_subsystem->cfg_apb[SUBSYS] = CFG_APB_SUBSYS;
  ff60401782:	fd843783          	ld	a5,-40(s0)
  ff60401786:	0ff09737          	lui	a4,0xff09
  ff6040178a:	0732                	slli	a4,a4,0xc
  ff6040178c:	f398                	sd	a4,32(a5)

    pcie_subsystem->link_mode = duowen_get_link_mode(pcie_subsystem);
  ff6040178e:	fd843503          	ld	a0,-40(s0)
  ff60401792:	a85ff0ef          	jal	ra,ff60401216 <duowen_get_link_mode>
  ff60401796:	87aa                	mv	a5,a0
  ff60401798:	873e                	mv	a4,a5
  ff6040179a:	fd843783          	ld	a5,-40(s0)
  ff6040179e:	02e78423          	sb	a4,40(a5)

    pcie_subsystem->controller = &controllers[0];
  ff604017a2:	fd843783          	ld	a5,-40(s0)
  ff604017a6:	00002717          	auipc	a4,0x2
  ff604017aa:	85a70713          	addi	a4,a4,-1958 # ff60403000 <controllers>
  ff604017ae:	fb98                	sd	a4,48(a5)
    for(i = 0; i < sizeof(controllers)/sizeof(struct dw_pcie); i++)
  ff604017b0:	fe0407a3          	sb	zero,-17(s0)
  ff604017b4:	a005                	j	ff604017d4 <instance_subsystem+0xa8>
        dw_controller_init(pcie_subsystem->controller + i);
  ff604017b6:	fd843783          	ld	a5,-40(s0)
  ff604017ba:	7b98                	ld	a4,48(a5)
  ff604017bc:	fef44783          	lbu	a5,-17(s0)
  ff604017c0:	07a2                	slli	a5,a5,0x8
  ff604017c2:	97ba                	add	a5,a5,a4
  ff604017c4:	853e                	mv	a0,a5
  ff604017c6:	f55ff0ef          	jal	ra,ff6040171a <dw_controller_init>
    for(i = 0; i < sizeof(controllers)/sizeof(struct dw_pcie); i++)
  ff604017ca:	fef44783          	lbu	a5,-17(s0)
  ff604017ce:	2785                	addiw	a5,a5,1
  ff604017d0:	fef407a3          	sb	a5,-17(s0)
  ff604017d4:	fef44783          	lbu	a5,-17(s0)
  ff604017d8:	0ff7f713          	andi	a4,a5,255
  ff604017dc:	478d                	li	a5,3
  ff604017de:	fce7fce3          	bgeu	a5,a4,ff604017b6 <instance_subsystem+0x8a>
}
  ff604017e2:	0001                	nop
  ff604017e4:	0001                	nop
  ff604017e6:	70a2                	ld	ra,40(sp)
  ff604017e8:	7402                	ld	s0,32(sp)
  ff604017ea:	6145                	addi	sp,sp,48
  ff604017ec:	8082                	ret

000000ff604017ee <clock_init>:

#ifndef TEST
// TODO: 
void clock_init(void)
{
  ff604017ee:	1141                	addi	sp,sp,-16
  ff604017f0:	e406                	sd	ra,8(sp)
  ff604017f2:	e022                	sd	s0,0(sp)
  ff604017f4:	0800                	addi	s0,sp,16
    clk_enable(pcie0_aclk);
  ff604017f6:	4515                	li	a0,5
  ff604017f8:	8d7fe0ef          	jal	ra,ff604000ce <clk_enable>
    clk_enable(pcie0_pclk);
  ff604017fc:	4519                	li	a0,6
  ff604017fe:	8d1fe0ef          	jal	ra,ff604000ce <clk_enable>
    clk_enable(pcie0_aux_clk);
  ff60401802:	451d                	li	a0,7
  ff60401804:	8cbfe0ef          	jal	ra,ff604000ce <clk_enable>
    clk_enable(pcie0_ref_clk);
  ff60401808:	4521                	li	a0,8
  ff6040180a:	8c5fe0ef          	jal	ra,ff604000ce <clk_enable>
    //__raw_writel(0x2, 0x401405c);

    clk_enable(srst_pcie0);
  ff6040180e:	4509                	li	a0,2
  ff60401810:	8bffe0ef          	jal	ra,ff604000ce <clk_enable>
    clk_enable(srst_pcie0_por);
  ff60401814:	4505                	li	a0,1
  ff60401816:	8b9fe0ef          	jal	ra,ff604000ce <clk_enable>
}
  ff6040181a:	0001                	nop
  ff6040181c:	60a2                	ld	ra,8(sp)
  ff6040181e:	6402                	ld	s0,0(sp)
  ff60401820:	0141                	addi	sp,sp,16
  ff60401822:	8082                	ret

000000ff60401824 <pci_platform_init>:
#endif

void pci_platform_init(void)
{
  ff60401824:	7179                	addi	sp,sp,-48
  ff60401826:	f406                	sd	ra,40(sp)
  ff60401828:	f022                	sd	s0,32(sp)
  ff6040182a:	1800                	addi	s0,sp,48
    struct duowen_pcie_subsystem *pcie_subsys;
    struct dw_pcie *controller;
    int i;

    pcie_subsys = &pcie_subsystem;
  ff6040182c:	00002797          	auipc	a5,0x2
  ff60401830:	bd478793          	addi	a5,a5,-1068 # ff60403400 <pcie_subsystem>
  ff60401834:	fcf43c23          	sd	a5,-40(s0)
    instance_subsystem(pcie_subsys);
  ff60401838:	fd843503          	ld	a0,-40(s0)
  ff6040183c:	ef1ff0ef          	jal	ra,ff6040172c <instance_subsystem>

#ifndef TEST
    clock_init();
  ff60401840:	fafff0ef          	jal	ra,ff604017ee <clock_init>
#endif
    subsys_link_init_pre(pcie_subsys);
  ff60401844:	fd843503          	ld	a0,-40(s0)
  ff60401848:	b01ff0ef          	jal	ra,ff60401348 <subsys_link_init_pre>
    reset_init(pcie_subsys);
  ff6040184c:	fd843503          	ld	a0,-40(s0)
  ff60401850:	9dbff0ef          	jal	ra,ff6040122a <reset_init>
    
    controller = pcie_subsys->controller;
  ff60401854:	fd843783          	ld	a5,-40(s0)
  ff60401858:	7b9c                	ld	a5,48(a5)
  ff6040185a:	fef43423          	sd	a5,-24(s0)

    for(i = 0; i < sizeof(controllers)/sizeof(struct dw_pcie); i++) {
  ff6040185e:	fe042223          	sw	zero,-28(s0)
  ff60401862:	a805                	j	ff60401892 <pci_platform_init+0x6e>
        if (controller->active == true) {
  ff60401864:	fe843783          	ld	a5,-24(s0)
  ff60401868:	0f87c783          	lbu	a5,248(a5)
  ff6040186c:	cb81                	beqz	a5,ff6040187c <pci_platform_init+0x58>
            dw_pcie_setup_rc(&(controller->pp));
  ff6040186e:	fe843783          	ld	a5,-24(s0)
  ff60401872:	05878793          	addi	a5,a5,88
  ff60401876:	853e                	mv	a0,a5
  ff60401878:	e06ff0ef          	jal	ra,ff60400e7e <dw_pcie_setup_rc>
        }
        controller++;
  ff6040187c:	fe843783          	ld	a5,-24(s0)
  ff60401880:	10078793          	addi	a5,a5,256
  ff60401884:	fef43423          	sd	a5,-24(s0)
    for(i = 0; i < sizeof(controllers)/sizeof(struct dw_pcie); i++) {
  ff60401888:	fe442783          	lw	a5,-28(s0)
  ff6040188c:	2785                	addiw	a5,a5,1
  ff6040188e:	fef42223          	sw	a5,-28(s0)
  ff60401892:	fe442783          	lw	a5,-28(s0)
  ff60401896:	873e                	mv	a4,a5
  ff60401898:	478d                	li	a5,3
  ff6040189a:	fce7f5e3          	bgeu	a5,a4,ff60401864 <pci_platform_init+0x40>
    }

    subsys_link_init_post(pcie_subsys);
  ff6040189e:	fd843503          	ld	a0,-40(s0)
  ff604018a2:	dc9ff0ef          	jal	ra,ff6040166a <subsys_link_init_post>
    __raw_writeq(0x64646464, (PCIE_SUBSYS_ADDR_START + 0x10));
  ff604018a6:	4785                	li	a5,1
  ff604018a8:	17aa                	slli	a5,a5,0x2a
  ff604018aa:	01078593          	addi	a1,a5,16
  ff604018ae:	646467b7          	lui	a5,0x64646
  ff604018b2:	46478513          	addi	a0,a5,1124 # 64646464 <__raw_writel-0xfefbdb9b9c>
  ff604018b6:	85fff0ef          	jal	ra,ff60401114 <__raw_writeq>

    uint32_t val;
    val = __raw_readq((PCIE_SUBSYS_ADDR_START + 0x10));
  ff604018ba:	4785                	li	a5,1
  ff604018bc:	17aa                	slli	a5,a5,0x2a
  ff604018be:	01078513          	addi	a0,a5,16
  ff604018c2:	895ff0ef          	jal	ra,ff60401156 <__raw_readq>
  ff604018c6:	87aa                	mv	a5,a0
  ff604018c8:	fcf42a23          	sw	a5,-44(s0)
    if (val == 0x64646464)
  ff604018cc:	fd442783          	lw	a5,-44(s0)
  ff604018d0:	0007871b          	sext.w	a4,a5
  ff604018d4:	646467b7          	lui	a5,0x64646
  ff604018d8:	46478793          	addi	a5,a5,1124 # 64646464 <__raw_writel-0xfefbdb9b9c>
  ff604018dc:	00f71863          	bne	a4,a5,ff604018ec <pci_platform_init+0xc8>
        printf("MEM64 Read/Write transaction passed\n");
  ff604018e0:	00001517          	auipc	a0,0x1
  ff604018e4:	81850513          	addi	a0,a0,-2024 # ff604020f8 <etext+0xf8>
  ff604018e8:	f5afe0ef          	jal	ra,ff60400042 <printf>

    __raw_writel(0x32323232, (PCIE_SUBSYS_ADDR_START + 0x100));
  ff604018ec:	4785                	li	a5,1
  ff604018ee:	17aa                	slli	a5,a5,0x2a
  ff604018f0:	10078593          	addi	a1,a5,256
  ff604018f4:	323237b7          	lui	a5,0x32323
  ff604018f8:	23278513          	addi	a0,a5,562 # 32323232 <__raw_writel-0xff2e0dcdce>
  ff604018fc:	ff6ff0ef          	jal	ra,ff604010f2 <__raw_writel>
    val = __raw_readl((PCIE_SUBSYS_ADDR_START + 0x100));
  ff60401900:	4785                	li	a5,1
  ff60401902:	17aa                	slli	a5,a5,0x2a
  ff60401904:	10078513          	addi	a0,a5,256
  ff60401908:	82fff0ef          	jal	ra,ff60401136 <__raw_readl>
  ff6040190c:	87aa                	mv	a5,a0
  ff6040190e:	fcf42a23          	sw	a5,-44(s0)
    if (val == 0x32323232)
  ff60401912:	fd442783          	lw	a5,-44(s0)
  ff60401916:	0007871b          	sext.w	a4,a5
  ff6040191a:	323237b7          	lui	a5,0x32323
  ff6040191e:	23278793          	addi	a5,a5,562 # 32323232 <__raw_writel-0xff2e0dcdce>
  ff60401922:	00f71863          	bne	a4,a5,ff60401932 <pci_platform_init+0x10e>
        printf("MEM32 Read/Write transaction passed\n");
  ff60401926:	00000517          	auipc	a0,0x0
  ff6040192a:	7fa50513          	addi	a0,a0,2042 # ff60402120 <etext+0x120>
  ff6040192e:	f14fe0ef          	jal	ra,ff60400042 <printf>
}
  ff60401932:	0001                	nop
  ff60401934:	70a2                	ld	ra,40(sp)
  ff60401936:	7402                	ld	s0,32(sp)
  ff60401938:	6145                	addi	sp,sp,48
  ff6040193a:	8082                	ret
	...
